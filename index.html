<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Plano de Ação do CIG — SEGOV/SEGEST</title>
<meta name="description" content="Ferramenta guiada para elaboração do Plano de Ação do CIG das Administrações Regionais do DF">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@300;400;600;700;900&display=swap" rel="stylesheet">
<style>
  :root {
    --bg-deep: #f1f5f9;
    --bg-card: #ffffff;
    --bg-input: #f8fafc;
    --border: #e2e8f0;
    --border-strong: #cbd5e1;
    --text-primary: #1e293b;
    --text-secondary: #475569;
    --text-muted: #64748b;
    --text-dim: #94a3b8;
    /* GDF institutional colors (from official logo) */
    --gdf-blue: #1565C0;
    --gdf-blue-dark: #0D4F8C;
    --gdf-blue-light: #E8F1FA;
    --gdf-blue-bg: #F0F6FC;
    --gdf-yellow: #FFD600;
    --accent-blue: #3b82f6;
    --accent-blue-dark: #2563eb;
    --accent-blue-light: #eff6ff;
    --accent-green: #10b981;
    --accent-green-dark: #059669;
    --accent-green-light: #ecfdf5;
    --accent-yellow: #d97706;
    --accent-yellow-light: #fffbeb;
    --accent-red: #ef4444;
    --accent-red-light: #fef2f2;
    --radius: 12px;
    --radius-sm: 8px;
    --shadow-sm: 0 1px 3px rgba(0,0,0,0.06), 0 1px 2px rgba(0,0,0,0.04);
    --shadow-md: 0 4px 12px rgba(0,0,0,0.07), 0 2px 4px rgba(0,0,0,0.04);
    --font: 'Source Sans 3', 'Segoe UI', system-ui, sans-serif;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: var(--font);
    background: var(--bg-deep);
    color: var(--text-primary);
    min-height: 100vh;
    padding: 24px 16px;
    -webkit-font-smoothing: antialiased;
  }

  ::selection { background: var(--gdf-blue); color: #fff; }

  .container { max-width: 780px; margin: 0 auto; }

  /* Header - GDF institutional */
  .header {
    display: flex; justify-content: space-between; align-items: center;
    margin-bottom: 20px; flex-wrap: wrap; gap: 12px;
    background: var(--bg-card); border-radius: var(--radius);
    padding: 14px 20px; box-shadow: var(--shadow-sm);
    border: 1px solid var(--border);
    border-top: 3px solid var(--gdf-blue);
  }
  .header-brand { display: flex; align-items: center; gap: 14px; }
  .gdf-badge {
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
  }
  .gdf-badge img {
    height: 40px; width: auto; border-radius: 4px;
  }
  .header-brand-text span {
    font-size: 10px; font-weight: 700; letter-spacing: 0.15em;
    color: var(--gdf-blue); text-transform: uppercase;
    display: block;
  }
  .header-brand-text h1 {
    font-size: 20px; font-weight: 900; color: var(--text-primary);
    letter-spacing: -0.02em; margin-top: 2px;
  }
  .header-actions { display: flex; gap: 8px; }

  /* Buttons */
  .btn-small {
    padding: 6px 14px; border-radius: var(--radius-sm); border: 1px solid var(--border);
    background: var(--bg-card); color: var(--text-secondary); font-size: 12px;
    font-weight: 600; cursor: pointer; font-family: var(--font); transition: all 0.2s;
  }
  .btn-small:hover { background: var(--bg-deep); color: var(--text-primary); border-color: var(--border-strong); }

  .btn-nav {
    padding: 12px 28px; border-radius: 10px; font-size: 14px; font-weight: 700;
    cursor: pointer; font-family: var(--font); transition: all 0.2s; border: none;
  }
  .btn-nav-next { background: var(--gdf-blue); color: #fff; box-shadow: 0 2px 8px rgba(21,101,192,0.25); }
  .btn-nav-next:hover { background: var(--gdf-blue-dark); }
  .btn-nav-prev { background: var(--bg-card); color: var(--text-secondary); border: 1.5px solid var(--border-strong); }
  .btn-nav-prev:hover { background: var(--bg-deep); color: var(--text-primary); }
  .btn-nav-print { background: var(--gdf-blue); color: #fff; box-shadow: 0 2px 8px rgba(21,101,192,0.25); }
  .btn-nav-print:hover { background: var(--gdf-blue-dark); }

  .btn-primary {
    padding: 14px 36px; border-radius: var(--radius); border: none;
    background: linear-gradient(135deg, var(--gdf-blue-dark), var(--gdf-blue));
    color: #fff; font-size: 16px; font-weight: 700; cursor: pointer;
    box-shadow: 0 4px 20px rgba(21,101,192,0.25); font-family: var(--font); transition: transform 0.2s;
  }
  .btn-primary:hover { transform: translateY(-1px); }

  .btn-ghost {
    padding: 14px 24px; border-radius: var(--radius); border: 1.5px solid var(--border-strong);
    background: var(--bg-card); color: var(--text-secondary); font-size: 14px;
    font-weight: 600; cursor: pointer; font-family: var(--font);
  }
  .btn-ghost:hover { background: var(--bg-deep); }

  /* Submit button */
  .btn-submit {
    padding: 16px 40px; border-radius: var(--radius); border: none;
    background: linear-gradient(135deg, var(--gdf-blue-dark), var(--gdf-blue));
    color: #fff; font-size: 17px; font-weight: 800; cursor: pointer;
    box-shadow: 0 4px 20px rgba(21,101,192,0.3); font-family: var(--font);
    transition: all 0.2s; width: 100%; letter-spacing: 0.01em;
  }
  .btn-submit:hover { transform: translateY(-1px); box-shadow: 0 6px 24px rgba(21,101,192,0.35); }
  .btn-submit:disabled {
    background: var(--border-strong); color: var(--text-dim);
    cursor: not-allowed; box-shadow: none; transform: none;
  }

  /* Loading spinner */
  .spinner {
    display: inline-block; width: 18px; height: 18px;
    border: 2.5px solid rgba(255,255,255,0.3); border-top-color: #fff;
    border-radius: 50%; animation: spin 0.7s linear infinite;
    vertical-align: middle; margin-right: 8px;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  /* Success screen */
  .success-screen { text-align: center; padding: 40px 0; }
  .success-icon { font-size: 64px; margin-bottom: 16px; animation: popIn 0.5s ease; }
  @keyframes popIn {
    0% { transform: scale(0); opacity: 0; }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); opacity: 1; }
  }
  .success-screen h2 { font-size: 26px; font-weight: 900; margin-bottom: 8px; color: var(--accent-green-dark); }
  .success-screen p { font-size: 15px; color: var(--text-secondary); max-width: 480px; margin: 0 auto 8px; line-height: 1.7; }
  .success-screen .sub { font-size: 13px; color: var(--text-muted); margin-bottom: 28px; }
  .success-actions { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; }
  .success-badge {
    display: inline-block; margin-top: 16px; padding: 8px 20px;
    background: var(--accent-green-light); border: 1px solid #a7f3d0;
    border-radius: 20px; font-size: 13px; font-weight: 600; color: var(--accent-green-dark);
  }

  /* Submission status on review */
  .submit-section {
    margin-top: 24px; padding: 20px; background: var(--accent-green-light);
    border: 1.5px solid #a7f3d0; border-radius: var(--radius); text-align: center;
  }
  .submit-section p { font-size: 13px; color: var(--text-secondary); margin-bottom: 14px; line-height: 1.6; }
  .already-sent {
    margin-top: 24px; padding: 16px; background: var(--accent-blue-light);
    border: 1px solid #bfdbfe; border-radius: var(--radius); text-align: center;
  }
  .already-sent p { font-size: 13px; color: var(--accent-blue-dark); margin-bottom: 10px; }

  /* Motivation messages */
  .motivation {
    text-align: center; padding: 8px 16px; margin-bottom: 16px;
    font-size: 13px; font-weight: 600; color: var(--gdf-blue);
    background: var(--gdf-blue-light); border-radius: 20px;
    border: 1px solid #93C5FD;
  }

  /* Phase Stepper */
  .phase-stepper {
    margin-bottom: 20px; background: var(--bg-card); border-radius: var(--radius);
    padding: 16px 18px; box-shadow: var(--shadow-sm); border: 1px solid var(--border);
  }
  .phase-stepper-bar {
    display: flex; align-items: center; gap: 0; margin-bottom: 10px;
  }
  .phase-step-item {
    flex: 1; text-align: center; cursor: pointer; position: relative;
    padding: 6px 4px; transition: all 0.2s;
  }
  .phase-step-num {
    display: inline-flex; align-items: center; justify-content: center;
    width: 26px; height: 26px; border-radius: 50%;
    font-size: 12px; font-weight: 700; margin-bottom: 4px;
    transition: all 0.3s;
  }
  .phase-step-item.completed .phase-step-num {
    background: var(--gdf-blue); color: #fff;
  }
  .phase-step-item.active .phase-step-num {
    background: var(--gdf-blue); color: #fff;
    box-shadow: 0 0 0 3px var(--gdf-blue-light);
  }
  .phase-step-item.future .phase-step-num {
    background: var(--border); color: var(--text-dim);
  }
  .phase-step-name {
    display: block; font-size: 10px; font-weight: 600;
    letter-spacing: 0.02em; line-height: 1.3;
    color: var(--text-dim); transition: color 0.2s;
  }
  .phase-step-item.completed .phase-step-name { color: var(--gdf-blue); }
  .phase-step-item.active .phase-step-name { color: var(--gdf-blue); font-weight: 700; }
  .phase-connector {
    width: 100%; height: 2px; background: var(--border);
    flex: 0.5; margin-top: -14px; transition: background 0.3s;
  }
  .phase-connector.done { background: var(--gdf-blue); }
  .phase-stepper-info {
    display: flex; justify-content: space-between; font-size: 12px;
    padding-top: 8px; border-top: 1px solid var(--border);
  }
  .phase-stepper-mobile {
    display: none; text-align: center; font-size: 12px;
    font-weight: 600; color: var(--gdf-blue);
  }

  /* Progress bar (kept for percentage) */
  .progress-track { height: 4px; background: var(--border); border-radius: 3px; overflow: hidden; }
  .progress-fill { height: 100%; background: linear-gradient(90deg, var(--gdf-blue), var(--accent-green)); border-radius: 3px; transition: width 0.4s ease; }

  /* Navigation */
  .nav-row { display: flex; justify-content: space-between; align-items: center; margin-top: 24px; gap: 12px; }
  .nav-right { display: flex; gap: 8px; align-items: center; }

  /* Content area */
  .step-card {
    background: var(--bg-card); border-radius: var(--radius);
    padding: 28px 24px; box-shadow: var(--shadow-md); border: 1px solid var(--border);
  }
  .step-content { transition: opacity 0.2s ease, transform 0.2s ease; }
  .step-content.fading { opacity: 0; transform: translateY(12px); }

  /* Question styling */
  .step-icon { font-size: 36px; display: block; margin-bottom: 8px; }
  .step-question { font-size: 24px; font-weight: 800; color: var(--text-primary); margin-bottom: 6px; letter-spacing: -0.01em; }
  .step-hint { font-size: 14px; color: var(--text-secondary); line-height: 1.6; margin-bottom: 20px; }

  /* Context note */
  .step-contexto {
    font-size: 13px; color: var(--gdf-blue); background: var(--gdf-blue-light);
    border: 1px solid #93C5FD; border-radius: 8px; padding: 8px 14px;
    margin-bottom: 12px; line-height: 1.5;
  }

  /* Group field separator */
  .group-field {
    margin-top: 28px; padding-top: 24px;
    border-top: 1.5px dashed var(--border);
  }
  .group-field:first-of-type {
    margin-top: 0; padding-top: 0; border-top: none;
  }
  .group-field-header {
    display: flex; align-items: center; gap: 8px; margin-bottom: 4px;
  }
  .group-field-icon { font-size: 22px; }
  .group-field-label { font-size: 17px; font-weight: 700; color: var(--text-primary); }
  .group-field-hint { font-size: 13px; color: var(--text-secondary); line-height: 1.5; margin-bottom: 12px; }

  /* Help tooltip */
  .ajuda-btn {
    background: none; border: 1px solid var(--border); cursor: pointer; font-size: 12px;
    vertical-align: middle; padding: 2px 8px; border-radius: 12px;
    color: var(--text-muted); font-family: var(--font); font-weight: 600;
    transition: all 0.2s; margin-left: 8px;
  }
  .ajuda-btn:hover { background: var(--gdf-blue-light); color: var(--gdf-blue); border-color: #93C5FD; }
  .ajuda-content {
    font-size: 13px; color: var(--text-secondary); background: var(--gdf-blue-bg);
    border: 1px solid #93C5FD; border-radius: 8px; padding: 10px 14px;
    margin-top: 8px; margin-bottom: 12px; line-height: 1.6;
  }

  /* Optional/required labels */
  .optional-tag {
    font-size: 12px; font-weight: 400; color: var(--text-dim);
    font-style: italic; margin-left: 4px;
  }

  /* Examples */
  .examples-label {
    font-size: 11px; font-weight: 700; color: var(--accent-yellow);
    letter-spacing: 0.1em; text-transform: uppercase; margin-bottom: 8px;
  }
  .example-card {
    background: var(--accent-yellow-light); border: 1px solid #fde68a;
    border-radius: 10px; padding: 10px 14px; cursor: pointer;
    transition: all 0.2s; margin-bottom: 8px;
  }
  .example-card:hover { border-color: var(--accent-yellow); background: #fef3c7; }
  .example-tag { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 3px; }
  .example-text { font-size: 13px; color: var(--text-secondary); line-height: 1.55; }
  .examples-hint { font-size: 11px; color: var(--text-dim); margin-top: 6px; font-style: italic; margin-bottom: 16px; }

  /* Inputs */
  textarea, input[type="text"], input[type="email"] {
    width: 100%; background: var(--bg-input); border: 2px solid var(--border);
    border-radius: var(--radius); padding: 14px 18px; font-size: 15px;
    color: var(--text-primary); line-height: 1.7; font-family: var(--font);
    resize: vertical; transition: border-color 0.2s; outline: none;
  }
  textarea:focus, input[type="text"]:focus, input[type="email"]:focus { border-color: var(--gdf-blue); box-shadow: 0 0 0 3px rgba(21,101,192,0.1); }
  input[type="text"], input[type="email"] { font-size: 16px; font-weight: 600; }

  select {
    width: 100%; background: var(--bg-input); border: 2px solid var(--border);
    border-radius: var(--radius); padding: 14px 18px; font-size: 16px;
    font-weight: 600; color: var(--text-primary); font-family: var(--font);
    cursor: pointer; transition: border-color 0.2s; outline: none;
    appearance: none; -webkit-appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%2364748b' stroke-width='2' fill='none'/%3E%3C/svg%3E");
    background-repeat: no-repeat; background-position: right 16px center;
  }
  select:focus { border-color: var(--gdf-blue); box-shadow: 0 0 0 3px rgba(21,101,192,0.1); }

  textarea.small-textarea {
    font-size: 13.5px; padding: 10px 14px; border-radius: var(--radius-sm);
    border-width: 1.5px;
  }
  select.small-select {
    font-size: 13.5px; padding: 10px 14px; border-radius: var(--radius-sm);
    border-width: 1.5px; font-weight: 600;
  }

  /* Partes interessadas */
  .partes-block {
    background: var(--bg-input); border-radius: var(--radius); padding: 16px;
    border: 1px solid var(--border); margin-bottom: 12px;
  }
  .partes-label { font-size: 12px; font-weight: 700; color: var(--text-primary); text-transform: uppercase; letter-spacing: 0.06em; margin-bottom: 4px; }
  .partes-examples { font-size: 11px; color: var(--accent-yellow); margin-bottom: 8px; }

  /* Entregas */
  .entrega-card {
    background: var(--bg-input); border: 1.5px solid var(--border); border-radius: var(--radius);
    padding: 16px; margin-bottom: 12px;
  }
  .entrega-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
  .entrega-badge {
    font-size: 12px; font-weight: 700; color: var(--gdf-blue);
    background: var(--gdf-blue-light); padding: 3px 12px; border-radius: 20px;
    border: 1px solid #93C5FD;
  }
  .entrega-remove {
    background: var(--accent-red-light); border: 1px solid #fecaca; border-radius: 6px;
    color: var(--accent-red); font-size: 11px; font-weight: 600; cursor: pointer;
    font-family: var(--font); padding: 4px 10px; transition: all 0.2s;
  }
  .entrega-remove:hover { background: #fee2e2; }
  .entrega-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  .entrega-field-label { font-size: 10px; font-weight: 700; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.06em; margin-bottom: 4px; }

  .btn-add-entrega {
    width: 100%; padding: 10px; border-radius: 10px; border: 1.5px dashed var(--border-strong);
    background: transparent; color: var(--text-muted); font-size: 13px; font-weight: 600;
    cursor: pointer; font-family: var(--font); transition: all 0.2s;
  }
  .btn-add-entrega:hover { background: var(--bg-input); color: var(--text-secondary); border-color: var(--gdf-blue); }

  /* Example block in entregas */
  .entregas-example {
    background: var(--accent-yellow-light); border: 1px solid #fde68a;
    border-radius: 10px; padding: 14px; margin-bottom: 16px;
  }

  /* Welcome */
  .welcome { text-align: center; padding: 40px 0; }
  .welcome-logo {
    display: inline-flex; align-items: center; gap: 12px;
    margin-bottom: 20px; padding: 10px 20px;
    background: var(--gdf-blue-light); border: 1px solid #93C5FD;
    border-radius: 12px;
  }
  .welcome-logo-badge {
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
  }
  .welcome-logo-badge img {
    height: 48px; width: auto; border-radius: 6px;
  }
  .welcome-logo-text {
    text-align: left; font-size: 13px; color: var(--gdf-blue);
    font-weight: 600; line-height: 1.4;
  }
  .welcome-logo-text strong { display: block; font-size: 15px; font-weight: 800; }
  .welcome h2 { font-size: 28px; font-weight: 900; margin-bottom: 12px; letter-spacing: -0.02em; }
  .welcome p { font-size: 16px; color: var(--text-secondary); max-width: 520px; margin: 0 auto 8px; line-height: 1.7; }
  .welcome .sub { font-size: 14px; color: var(--text-muted); max-width: 480px; margin: 0 auto 24px; line-height: 1.6; }
  .welcome-time {
    display: inline-flex; align-items: center; gap: 6px;
    padding: 8px 20px; border-radius: 20px;
    background: var(--gdf-blue-light); border: 1px solid #93C5FD;
    font-size: 14px; font-weight: 600; color: var(--gdf-blue);
    margin-bottom: 20px;
  }
  .welcome-btns { display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; }
  .welcome-features {
    display: flex; gap: 16px; justify-content: center; margin-top: 32px; flex-wrap: wrap;
  }
  .welcome-feat {
    display: flex; align-items: center; gap: 8px; font-size: 13px;
    color: var(--text-muted); background: var(--bg-input);
    padding: 8px 14px; border-radius: 20px; border: 1px solid var(--border);
  }
  .welcome-feat span { font-size: 18px; }
  .welcome-info-toggle {
    background: none; border: 1px solid var(--border); border-radius: 20px;
    padding: 8px 20px; font-size: 13px; font-weight: 600; color: var(--gdf-blue);
    cursor: pointer; font-family: var(--font); transition: all 0.2s; margin-top: 24px;
    display: inline-block;
  }
  .welcome-info-toggle:hover { background: var(--gdf-blue-light); border-color: #93C5FD; }
  .welcome-info-content {
    margin-top: 16px; padding: 20px 24px; background: var(--bg-input);
    border: 1px solid var(--border); border-radius: var(--radius);
    text-align: left; max-width: 540px; margin-left: auto; margin-right: auto;
  }
  .welcome-info-content p {
    font-size: 14px !important; color: var(--text-secondary) !important;
    line-height: 1.7 !important; margin-bottom: 10px !important; max-width: none !important;
    text-align: left !important;
  }
  .welcome-info-content p:last-child { margin-bottom: 0 !important; }

  /* Autosave indicator */
  .autosave-indicator {
    position: fixed; bottom: 16px; right: 16px; padding: 6px 14px;
    background: var(--accent-green-light); color: var(--accent-green-dark);
    border: 1px solid #a7f3d0; border-radius: 20px;
    font-size: 11px; font-weight: 600; font-family: var(--font);
    opacity: 0; transition: opacity 0.3s; pointer-events: none; z-index: 100;
  }
  .autosave-indicator.show { opacity: 1; }

  /* Review */
  .review-header { text-align: center; margin-bottom: 28px; }
  .review-header .icon { font-size: 48px; margin-bottom: 8px; }
  .review-header h2 { font-size: 26px; font-weight: 900; margin-bottom: 6px; }
  .review-header p { font-size: 14px; color: var(--text-secondary); }
  .review-ra {
    display: inline-block; margin-top: 12px; padding: 6px 18px;
    background: var(--gdf-blue-light); border: 1px solid #93C5FD;
    border-radius: 20px; font-size: 14px; font-weight: 700; color: var(--gdf-blue);
  }

  .review-item {
    display: flex; align-items: flex-start; gap: 12px;
    background: var(--bg-card); border: 1px solid var(--border); border-radius: 10px;
    padding: 12px 16px; cursor: pointer; width: 100%; text-align: left;
    transition: all 0.2s; font-family: var(--font); margin-bottom: 8px;
    box-shadow: var(--shadow-sm);
  }
  .review-item:hover { border-color: var(--gdf-blue); box-shadow: 0 2px 8px rgba(21,101,192,0.1); }
  .review-item.pending { background: var(--accent-red-light); border-color: #fecaca; }
  .review-item-icon { font-size: 20px; flex-shrink: 0; }
  .review-item-body { flex: 1; min-width: 0; }
  .review-item-label { font-size: 12px; font-weight: 700; margin-bottom: 2px; }
  .review-item-label.filled { color: var(--text-primary); }
  .review-item-label.empty { color: var(--accent-red); }
  .review-item-preview {
    font-size: 12px; color: var(--text-muted); overflow: hidden;
    display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;
    white-space: pre-wrap; line-height: 1.5;
  }
  .review-edit { color: var(--text-dim); font-size: 16px; flex-shrink: 0; }
  .review-actions { display: flex; gap: 10px; justify-content: center; margin-top: 20px; flex-wrap: wrap; }

  /* Review section group headers */
  .review-group-label {
    font-size: 11px; font-weight: 700; color: var(--gdf-blue);
    letter-spacing: 0.1em; text-transform: uppercase;
    margin-top: 16px; margin-bottom: 8px; padding-left: 4px;
  }
  .review-group-label:first-child { margin-top: 0; }

  /* Error message */
  .error-msg {
    margin-top: 12px; padding: 12px 16px; background: var(--accent-red-light);
    border: 1px solid #fecaca; border-radius: var(--radius-sm);
    font-size: 13px; color: #991b1b; text-align: center;
  }

  /* Footer */
  .footer {
    text-align: center; font-size: 10px; color: var(--text-dim);
    margin-top: 32px; padding-top: 16px; border-top: 1px solid var(--border); line-height: 1.6;
  }

  /* Print styles */
  @media print {
    body { background: #fff !important; color: #000 !important; padding: 16px; }
    .no-print { display: none !important; }
    .container { max-width: 100%; }
    .step-card { box-shadow: none !important; border: 1px solid #ddd !important; }
    textarea, input[type="text"], input[type="email"], select { border: 1px solid #ccc !important; background: #fff !important; color: #000 !important; min-height: 30px !important; font-size: 12px !important; box-shadow: none !important; }
    .step-question { color: #000 !important; font-size: 16px !important; }
    .step-hint { color: #333 !important; font-size: 11px !important; }
    .step-icon { font-size: 20px !important; }
    .review-item { background: #f9f9f9 !important; border-color: #ddd !important; box-shadow: none !important; }
    .review-item-label { color: #000 !important; }
    .review-item-preview { color: #333 !important; }
    .footer { color: #999 !important; border-top-color: #ddd !important; }
    .header { box-shadow: none !important; }
    .header-brand-text h1 { color: #000 !important; }
    .header-brand-text span { color: #666 !important; }
    .review-ra { background: #e0e7ff !important; color: #1e40af !important; }
    .autosave-indicator { display: none !important; }
  }

  /* Responsive */
  @media (max-width: 600px) {
    .welcome h2 { font-size: 22px; }
    .step-question { font-size: 20px; }
    .entrega-grid { grid-template-columns: 1fr; }
    .welcome-features { flex-direction: column; align-items: center; }
    .nav-row { flex-direction: column; }
    .nav-right { width: 100%; justify-content: center; }
    .btn-nav { width: 100%; text-align: center; }
    .review-actions { flex-direction: column; }
    .review-actions button { width: 100%; text-align: center; }
    .success-actions { flex-direction: column; }
    .success-actions button { width: 100%; }
    .step-card { padding: 20px 16px; }
    .phase-stepper-bar { display: none; }
    .phase-stepper-mobile { display: block; }
    .phase-stepper-info { flex-direction: column; gap: 4px; text-align: center; }
  }
</style>
</head>
<body>

<div class="container" id="app"></div>
<div class="autosave-indicator" id="autosave-indicator">Salvo automaticamente</div>

<script>
/* ===================================================
   CONFIGURACAO - URL DO GOOGLE APPS SCRIPT
   =================================================== */
var GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzvLX37nFf9wZrSga5WzuXcG56ZLSgc1p7akVW4_52kZAUD-TjF69CsCEPbd_t-X05QEw/exec';

/* ===================================================
   REGIOES ADMINISTRATIVAS DO DF
   =================================================== */
var REGIOES_DF = [
  "RA-I Plano Piloto",
  "RA-II Gama",
  "RA-III Taguatinga",
  "RA-IV Brazl\u00e2ndia",
  "RA-V Sobradinho",
  "RA-VI Planaltina",
  "RA-VII Parano\u00e1",
  "RA-VIII N\u00facleo Bandeirante",
  "RA-IX Ceil\u00e2ndia",
  "RA-X Guar\u00e1",
  "RA-XI Cruzeiro",
  "RA-XII Samambaia",
  "RA-XIII Santa Maria",
  "RA-XIV S\u00e3o Sebasti\u00e3o",
  "RA-XV Recanto das Emas",
  "RA-XVI Lago Sul",
  "RA-XVII Riacho Fundo",
  "RA-XVIII Lago Norte",
  "RA-XIX Candangol\u00e2ndia",
  "RA-XX \u00c1guas Claras",
  "RA-XXI Riacho Fundo II",
  "RA-XXII Sudoeste/Octogonal",
  "RA-XXIII Varj\u00e3o",
  "RA-XXIV Park Way",
  "RA-XXV SCIA/Estrutural",
  "RA-XXVI Sobradinho II",
  "RA-XXVII Jardim Bot\u00e2nico",
  "RA-XXVIII Itapo\u00e3",
  "RA-XXIX SIA",
  "RA-XXX Vicente Pires",
  "RA-XXXI Fercal",
  "RA-XXXII Sol Nascente e P\u00f4r do Sol",
  "RA-XXXIII Arniqueira",
  "RA-XXXIV Arapoanga",
  "RA-XXXV \u00c1gua Quente"
];

/* ===================================================
   PRATICAS DE GOVERNANCA (Resolucao CGOV N 04/2024)
   =================================================== */
var PRATICAS_GOVERNANCA = [
  "Comit\u00ea Interno de Governan\u00e7a (CIG)",
  "Planejamento Estrat\u00e9gico",
  "Gest\u00e3o de Riscos",
  "Programa de Integridade P\u00fablica",
  "Programa de Integridade Privada",
  "Conformidade",
  "Controle Interno",
  "Correi\u00e7\u00e3o",
  "Ouvidoria",
  "Transpar\u00eancia",
  "Governan\u00e7a de Pessoas",
  "Governan\u00e7a de Dados",
  "Governan\u00e7a nas Contrata\u00e7\u00f5es",
  "Gerenciamento de Processos",
  "Inova\u00e7\u00e3o",
  "Dimens\u00e3o Ambiental",
  "Dimens\u00e3o Social"
];

/* ===================================================
   PRAZOS PARA ENTREGAS (dropdown)
   =================================================== */
var PRAZOS_OPCOES = [
  "15 dias", "30 dias", "45 dias", "60 dias",
  "90 dias", "120 dias", "180 dias", "12 meses"
];

/* ===================================================
   FIELD DEFINITIONS (all individual fields)
   =================================================== */
var FIELD_DEFS = {
  responsavel_nome: {
    field: "responsavel_nome", label: "Nome do Respons\u00e1vel",
    question: "Qual \u00e9 o seu nome?",
    dica: "Nome completo do servidor respons\u00e1vel pelo preenchimento deste plano.",
    placeholder: "Seu nome completo...",
    icon: "\uD83D\uDC64", color: "#1565C0", inputType: "input",
    exemplos: []
  },
  responsavel_email: {
    field: "responsavel_email", label: "E-mail Institucional",
    question: "Qual \u00e9 o seu e-mail institucional?",
    dica: "E-mail para contato sobre este plano de a\u00e7\u00e3o.",
    placeholder: "seu.email@df.gov.br",
    icon: "\uD83D\uDCE7", color: "#1565C0", inputType: "email",
    exemplos: []
  },
  ra: {
    field: "ra", label: "Regi\u00e3o Administrativa",
    question: "Qual \u00e9 a sua Regi\u00e3o Administrativa?",
    dica: "Selecione sua RA na lista abaixo.",
    placeholder: "Selecione sua Regi\u00e3o Administrativa...",
    icon: "\uD83D\uDCCD", color: "#1565C0", inputType: "select",
    opcoes: REGIOES_DF, exemplos: []
  },
  pratica: {
    field: "pratica", label: "Pr\u00e1tica de Governan\u00e7a",
    question: "A qual pr\u00e1tica de governan\u00e7a este projeto se refere?",
    dica: "Selecione a pr\u00e1tica principal que o projeto vai implementar ou fortalecer, conforme a Resolu\u00e7\u00e3o CGOV N\u00ba 04/2024.",
    placeholder: "Selecione a pr\u00e1tica de governan\u00e7a...",
    icon: "\uD83C\uDFDB\uFE0F", color: "#7c3aed", inputType: "select",
    opcoes: PRATICAS_GOVERNANCA, exemplos: []
  },
  projeto: {
    field: "projeto", label: "Nome do Projeto",
    question: "Qual \u00e9 o nome do seu projeto?",
    dica: "Escolha um nome claro e direto. Inclua a sigla da RA para facilitar a identifica\u00e7\u00e3o.",
    placeholder: "Digite o nome do projeto...",
    icon: "\uD83C\uDFAF", color: "#1565C0",
    exemplos: [
      { titulo: "Governan\u00e7a", texto: "Implanta\u00e7\u00e3o do Comit\u00ea Interno de Governan\u00e7a (CIG) da RA-IX" },
      { titulo: "Atendimento", texto: "Moderniza\u00e7\u00e3o do Atendimento ao Cidad\u00e3o na RA-III Taguatinga" },
      { titulo: "Gest\u00e3o de Riscos", texto: "Programa de Gest\u00e3o de Riscos Operacionais da RA-I Plano Piloto" },
      { titulo: "Transpar\u00eancia", texto: "Portal de Transpar\u00eancia e Presta\u00e7\u00e3o de Contas da RA-V Sobradinho" }
    ]
  },
  objetivo: {
    field: "objetivo", label: "Objetivo do Projeto",
    question: "O que este projeto pretende alcan\u00e7ar?",
    dica: "Descreva o resultado final desejado. Use verbos como: estruturar, implantar, reduzir, melhorar...",
    placeholder: "Descreva o objetivo principal...",
    icon: "\uD83C\uDFC6", color: "#dc2626",
    exemplos: [
      { titulo: "Governan\u00e7a", texto: "Estruturar o CIG como inst\u00e2ncia deliberativa para qualificar decis\u00f5es e dar seguran\u00e7a jur\u00eddica \u00e0 gest\u00e3o da RA." },
      { titulo: "Atendimento", texto: "Reduzir em 50% o tempo de espera do cidad\u00e3o e implantar sistema de agendamento online." },
      { titulo: "Contratos", texto: "Garantir 100% de conformidade na fiscaliza\u00e7\u00e3o de contratos vigentes da RA." }
    ]
  },
  descricao: {
    field: "descricao", label: "Descri\u00e7\u00e3o do Projeto",
    question: "Descreva brevemente o projeto.",
    dica: "Diferente do objetivo (o que quer alcan\u00e7ar), aqui descreva o que ser\u00e1 feito na pr\u00e1tica, a abrang\u00eancia e a quais diretrizes est\u00e1 vinculado.",
    placeholder: "Descreva o escopo e contexto...",
    icon: "\uD83D\uDCCB", color: "#2563eb",
    exemplos: [
      { titulo: "Governan\u00e7a", texto: "Formaliza\u00e7\u00e3o do CIG por portaria, elabora\u00e7\u00e3o de regimento interno, capacita\u00e7\u00e3o dos membros e in\u00edcio das reuni\u00f5es ordin\u00e1rias mensais, alinhado \u00e0s diretrizes da SEGOV/CGDF." },
      { titulo: "Capacita\u00e7\u00e3o", texto: "Programa de capacita\u00e7\u00e3o continuada para 45 servidores da RA em gest\u00e3o p\u00fablica, integridade e atendimento, com 6 m\u00f3dulos ao longo de 12 meses." }
    ]
  },
  produto: {
    field: "produto", label: "Produto Principal",
    question: "Qual \u00e9 o resultado concreto que ser\u00e1 entregue?",
    dica: "Diferente do objetivo (abstrato), o produto \u00e9 algo concreto \u2014 que se possa apontar e dizer: \"isto foi entregue\".",
    placeholder: "O principal produto do projeto...",
    icon: "\uD83D\uDCE6", color: "#ea580c",
    exemplos: [
      { titulo: "Governan\u00e7a", texto: "CIG formalmente institu\u00eddo, com regimento aprovado e reuni\u00f5es ordin\u00e1rias em funcionamento." },
      { titulo: "Atendimento", texto: "Central de atendimento reorganizada com sistema de senhas, agendamento e pesquisa de satisfa\u00e7\u00e3o." },
      { titulo: "Riscos", texto: "Matriz de riscos da RA elaborada com planos de tratamento para os 10 riscos priorit\u00e1rios." }
    ]
  },
  caracteristicas: {
    field: "caracteristicas", label: "Caracter\u00edsticas",
    question: "Quais s\u00e3o as caracter\u00edsticas essenciais desse produto?",
    dica: "Liste os atributos que tornam o produto completo. Pense: \"para funcionar bem, ele precisa ser/ter...\"",
    ajuda: "Caracter\u00edsticas s\u00e3o os atributos de qualidade do que ser\u00e1 entregue. Exemplo: se o produto \u00e9 um comit\u00ea, as caracter\u00edsticas podem ser 'reuni\u00f5es mensais', 'atas no SEI', 'composi\u00e7\u00e3o multissetorial'.",
    placeholder: "Caracter\u00edsticas do produto principal...",
    icon: "\u2B50", color: "#7c3aed",
    exemplos: [
      { titulo: "CIG", texto: "Composi\u00e7\u00e3o multissetorial \u2022 Reuni\u00f5es mensais com ata no SEI \u2022 Pauta estruturada \u2022 Delibera\u00e7\u00f5es registradas \u2022 Alinhamento com a SEGOV/CGDF." },
      { titulo: "Atendimento", texto: "Acess\u00edvel a PCD \u2022 Bil\u00edngue (portugu\u00eas/Libras) \u2022 Tempo m\u00e1ximo de espera: 15 min \u2022 Pesquisa de satisfa\u00e7\u00e3o digital." }
    ]
  },
  justificativa: {
    field: "justificativa", label: "Justificativa",
    question: "Por que este projeto \u00e9 necess\u00e1rio?",
    dica: "Responda: qual problema resolve? Que risco evita? Por que agora? Traga dados se poss\u00edvel.",
    placeholder: "O que motiva este projeto...",
    icon: "\u2705", color: "#059669",
    exemplos: [
      { titulo: "Governan\u00e7a", texto: "A aus\u00eancia de inst\u00e2ncia formal de governan\u00e7a exp\u00f5e a gest\u00e3o a riscos em auditorias do TCDF. As oficinas SEGOV/CGDF criaram a base t\u00e9cnica para implementa\u00e7\u00e3o imediata." },
      { titulo: "Atendimento", texto: "Pesquisa da Ouvidoria indica que 67% das reclama\u00e7\u00f5es referem-se a tempo de espera. A RA atende 12 mil cidad\u00e3os/m\u00eas sem sistema de organiza\u00e7\u00e3o." }
    ]
  },
  indicador: {
    field: "indicador", label: "Indicador de Resultado",
    question: "Como voc\u00ea vai medir o sucesso?",
    dica: "Pense em n\u00fameros concretos: percentuais, quantidades, prazos. Se o projeto der certo, que n\u00famero muda?",
    ajuda: "Indicadores s\u00e3o n\u00fameros que mostram se o projeto est\u00e1 funcionando. Pense em algo que voc\u00ea possa contar ou medir. Exemplo: 'n\u00famero de reuni\u00f5es realizadas' ou 'tempo m\u00e9dio de atendimento'.",
    placeholder: "Indicadores de sucesso...",
    icon: "\uD83D\uDCCA", color: "#059669",
    exemplos: [
      { titulo: "Governan\u00e7a", texto: "% de reuni\u00f5es realizadas vs. programadas (meta: 100%).\nN\u00ba de riscos identificados e tratados.\n\u00cdndice de conformidade no checklist da CGDF." },
      { titulo: "Atendimento", texto: "Tempo m\u00e9dio de espera (meta: < 15 min).\n\u00cdndice de satisfa\u00e7\u00e3o do cidad\u00e3o (meta: > 80%).\nN\u00ba de atendimentos/dia." }
    ]
  },
  premissas: {
    field: "premissas", label: "Premissas",
    question: "O que precisa dar certo para o projeto funcionar?",
    dica: "S\u00e3o condi\u00e7\u00f5es que voc\u00ea assume como verdadeiras. Se alguma falhar, o projeto fica comprometido.",
    ajuda: "Premissas s\u00e3o coisas que voc\u00ea assume como certas para o projeto funcionar. Exemplo: 'os servidores ter\u00e3o tempo dedicado', 'o SEI estar\u00e1 dispon\u00edvel'. Se alguma premissa falhar, o projeto pode ser prejudicado.",
    placeholder: "Fatores cr\u00edticos de sucesso...",
    icon: "\uD83C\uDFC5", color: "#b45309",
    exemplos: [
      { titulo: "T\u00edpicas", texto: "Apoio do(a) Administrador(a) Regional.\nServidores capacitados com disponibilidade de tempo.\nAcesso ao SEI funcionando.\nSuporte t\u00e9cnico da SEGOV conforme comprometido." }
    ]
  },
  barreiras: {
    field: "barreiras", label: "Barreiras",
    question: "Quais dificuldades j\u00e1 existem hoje?",
    dica: "Diferente de riscos (que podem acontecer), barreiras s\u00e3o obst\u00e1culos conhecidos e atuais \u2014 coisas que j\u00e1 atrapalham.",
    placeholder: "Dificuldades existentes...",
    icon: "\uD83D\uDEA7", color: "#dc2626",
    exemplos: [
      { titulo: "Comuns nas RAs", texto: "Ac\u00famulo de fun\u00e7\u00f5es dos servidores.\nResist\u00eancia cultural a mudan\u00e7as.\nRotatividade em cargos comissionados.\nInfraestrutura limitada (salas, equipamentos)." }
    ]
  },
  riscos: {
    field: "riscos", label: "Riscos",
    question: "O que pode dar errado no futuro?",
    dica: "Eventos incertos mas poss\u00edveis. Pense: \"e se acontecer X, como impacta o projeto?\"",
    placeholder: "Eventos que podem impactar...",
    icon: "\u26A0\uFE0F", color: "#d97706",
    exemplos: [
      { titulo: "Frequentes", texto: "Troca de Administrador(a) com descontinuidade.\nPerda de servidores capacitados por remo\u00e7\u00e3o.\nSobrecarga de demandas urgentes.\nCorte or\u00e7ament\u00e1rio inesperado." }
    ]
  }
};

/* ===================================================
   STEPS (grouped screens - 10 instead of 16)
   =================================================== */
var STEPS = [
  { id: "welcome", type: "welcome" },
  {
    id: "identificacao", type: "group", label: "Identifica\u00e7\u00e3o",
    icon: "\uD83D\uDCCD", question: "Identifique sua RA e a pr\u00e1tica de governan\u00e7a",
    dica: "Selecione os dados b\u00e1sicos para come\u00e7ar o plano.",
    fields: ["responsavel_nome", "responsavel_email", "ra", "pratica"]
  },
  {
    id: "nome-objetivo", type: "group", label: "Nome e Objetivo",
    icon: "\uD83C\uDFAF", question: "Defina o nome e o objetivo do projeto",
    dica: "Escolha um nome claro e descreva o que pretende alcan\u00e7ar.",
    contexto: "Com a RA e pr\u00e1tica definidas, vamos nomear e direcionar o projeto.",
    fields: ["projeto", "objetivo"]
  },
  {
    id: "detalhamento", type: "group", label: "Descri\u00e7\u00e3o e Produto",
    icon: "\uD83D\uDCCB", question: "Descreva o projeto e o produto esperado",
    dica: "Explique o que ser\u00e1 feito na pr\u00e1tica e qual ser\u00e1 a entrega concreta.",
    contexto: "Com o objetivo definido, descreva como pretende chegar l\u00e1 e o que ser\u00e1 entregue.",
    fields: ["descricao", "produto"]
  },
  {
    id: "caracteristicas", type: "single", label: "Caracter\u00edsticas",
    fieldId: "caracteristicas"
  },
  {
    id: "analise", type: "group", label: "Justificativa e Indicadores",
    icon: "\uD83D\uDCCA", question: "Justifique o projeto e defina como medir o sucesso",
    dica: "Explique por que o projeto \u00e9 necess\u00e1rio e como ser\u00e1 avaliado.",
    contexto: "Agora explique por que vale a pena investir e como saber se deu certo.",
    fields: ["justificativa", "indicador"]
  },
  {
    id: "partes", type: "partes", label: "Partes Interessadas",
    question: "Quem est\u00e1 envolvido no projeto?",
    contexto: "Vamos identificar as pessoas e grupos ligados ao projeto.",
    icon: "\uD83D\uDC65", color: "#334155",
    dica: "Identifique quem patrocina (apoia/decide), quem executa (faz o trabalho) e quem se beneficia (usa o resultado).",
    ajuda: "Partes interessadas s\u00e3o todas as pessoas ou grupos que influenciam ou s\u00e3o influenciados pelo projeto: quem decide, quem executa, quem usa o resultado final.",
    exemplos: {
      patrocinio: ["Administrador(a) Regional (patrocinador)", "Chefe de Gabinete (gestor do projeto)"],
      equipe: ["Membros do CIG capacitados nas oficinas", "Representantes das coordena\u00e7\u00f5es", "Assessoria jur\u00eddica da RA"],
      publico: ["Diretos: servidores e gestores da RA", "Indiretos: popula\u00e7\u00e3o da regi\u00e3o administrativa", "\u00d3rg\u00e3os de controle: TCDF, CGDF"]
    }
  },
  {
    id: "entregas", type: "entregas", label: "Entregas Intermedi\u00e1rias",
    question: "Quebre o projeto em etapas \u2014 o que ser\u00e1 entregue em cada uma?",
    contexto: "Com tudo definido, divida o projeto em etapas menores e concretas.",
    icon: "\uD83D\uDCC5", color: "#059669",
    dica: "Cada entrega deve ter: o que ser\u00e1 entregue, as atividades necess\u00e1rias, prazo e custo estimado.",
    ajuda: "Entregas intermedi\u00e1rias s\u00e3o os marcos do projeto \u2014 resultados parciais que mostram que o trabalho est\u00e1 avan\u00e7ando. Pense nos passos at\u00e9 chegar ao produto final.",
    exemplos: [
      { entrega: "Ato normativo do CIG publicado.", atividades: "Minutar portaria \u2192 Assessoria jur\u00eddica \u2192 Assinatura \u2192 Publica\u00e7\u00e3o no DODF.", prazo: "30 dias", investimento: "Sem custo direto." },
      { entrega: "1\u00aa reuni\u00e3o ordin\u00e1ria realizada.", atividades: "Regimento aprovado \u2192 Pauta definida \u2192 Convoca\u00e7\u00e3o \u2192 Ata registrada no SEI.", prazo: "60 dias", investimento: "Sem custo direto." }
    ]
  },
  {
    id: "riscos-premissas", type: "group", label: "Premissas, Barreiras e Riscos",
    icon: "\u26A0\uFE0F", question: "Identifique premissas, barreiras e riscos",
    dica: "Pense nas condi\u00e7\u00f5es necess\u00e1rias, obst\u00e1culos existentes e o que pode dar errado.",
    contexto: "\u00daltimo bloco! Identifique o que pode influenciar o sucesso do projeto.",
    fields: ["premissas", "barreiras", "riscos"]
  },
  { id: "review", type: "review" }
];

/* ===================================================
   PHASES (visual grouping for stepper)
   =================================================== */
var PHASES = [
  { name: "Identifica\u00e7\u00e3o", steps: ["identificacao", "nome-objetivo"] },
  { name: "Detalhamento", steps: ["detalhamento", "caracteristicas"] },
  { name: "An\u00e1lise", steps: ["analise"] },
  { name: "Pessoas e Entregas", steps: ["partes", "entregas"] },
  { name: "Premissas e Riscos", steps: ["riscos-premissas"] }
];

/* ===================================================
   REVIEW ITEMS (individual fields for review screen)
   =================================================== */
var REVIEW_ITEMS = [
  { id: "responsavel_nome", field: "responsavel_nome", label: "Nome do Respons\u00e1vel", icon: "\uD83D\uDC64", phase: "Identifica\u00e7\u00e3o" },
  { id: "responsavel_email", field: "responsavel_email", label: "E-mail Institucional", icon: "\uD83D\uDCE7", phase: "Identifica\u00e7\u00e3o" },
  { id: "ra", field: "ra", label: "Regi\u00e3o Administrativa", icon: "\uD83D\uDCCD", phase: "Identifica\u00e7\u00e3o" },
  { id: "pratica", field: "pratica", label: "Pr\u00e1tica de Governan\u00e7a", icon: "\uD83C\uDFDB\uFE0F", phase: "Identifica\u00e7\u00e3o" },
  { id: "projeto", field: "projeto", label: "Nome do Projeto", icon: "\uD83C\uDFAF", phase: "Identifica\u00e7\u00e3o" },
  { id: "objetivo", field: "objetivo", label: "Objetivo", icon: "\uD83C\uDFC6", phase: "Identifica\u00e7\u00e3o" },
  { id: "descricao", field: "descricao", label: "Descri\u00e7\u00e3o", icon: "\uD83D\uDCCB", phase: "Detalhamento" },
  { id: "produto", field: "produto", label: "Produto Principal", icon: "\uD83D\uDCE6", phase: "Detalhamento" },
  { id: "caracteristicas", field: "caracteristicas", label: "Caracter\u00edsticas", icon: "\u2B50", phase: "Detalhamento" },
  { id: "justificativa", field: "justificativa", label: "Justificativa", icon: "\u2705", phase: "An\u00e1lise" },
  { id: "indicador", field: "indicador", label: "Indicador", icon: "\uD83D\uDCCA", phase: "An\u00e1lise" },
  { id: "partes", type: "partes", label: "Partes Interessadas", icon: "\uD83D\uDC65", phase: "Pessoas e Entregas" },
  { id: "entregas", type: "entregas", label: "Entregas", icon: "\uD83D\uDCC5", phase: "Pessoas e Entregas" },
  { id: "premissas", field: "premissas", label: "Premissas", icon: "\uD83C\uDFC5", phase: "Premissas e Riscos" },
  { id: "barreiras", field: "barreiras", label: "Barreiras", icon: "\uD83D\uDEA7", phase: "Premissas e Riscos" },
  { id: "riscos", field: "riscos", label: "Riscos", icon: "\u26A0\uFE0F", phase: "Premissas e Riscos" }
];

function getPhaseForStep(stepId) {
  for (var i = 0; i < PHASES.length; i++) {
    if (PHASES[i].steps.indexOf(stepId) >= 0) return PHASES[i].name;
  }
  return '';
}

function getCurrentPhaseIndex() {
  var step = STEPS[currentStep];
  for (var i = 0; i < PHASES.length; i++) {
    if (PHASES[i].steps.indexOf(step.id) >= 0) return i;
  }
  return -1;
}

function getStepIndexForField(fieldId) {
  for (var i = 0; i < STEPS.length; i++) {
    var s = STEPS[i];
    if (s.fieldId === fieldId) return i;
    if (s.type === 'group' && s.fields && s.fields.indexOf(fieldId) >= 0) return i;
    if (s.type === 'partes' && ['patrocinio', 'equipe', 'publico', 'partes'].indexOf(fieldId) >= 0) return i;
    if (s.type === 'entregas' && fieldId === 'entregas') return i;
  }
  return 1;
}

function getFirstStepOfPhase(phaseIdx) {
  if (phaseIdx < 0 || phaseIdx >= PHASES.length) return 1;
  var firstStepId = PHASES[phaseIdx].steps[0];
  for (var i = 0; i < STEPS.length; i++) {
    if (STEPS[i].id === firstStepId) return i;
  }
  return 1;
}

/* ===================================================
   CAMPOS OBRIGATORIOS
   =================================================== */
var REQUIRED_FIELDS = ['responsavel_nome', 'ra', 'pratica', 'projeto', 'objetivo', 'descricao', 'produto', 'caracteristicas', 'justificativa', 'indicador', 'partes', 'entregas', 'premissas', 'barreiras', 'riscos'];

function isRequired(fieldOrId) {
  return REQUIRED_FIELDS.indexOf(fieldOrId) >= 0;
}

/* ===================================================
   MOTIVATION MESSAGES
   =================================================== */
var MOTIVATIONS = [
  { min: 0, max: 10, msg: "Vamos l\u00e1! O primeiro passo \u00e9 o mais importante." },
  { min: 11, max: 25, msg: "\u00d3timo come\u00e7o! Continue preenchendo, est\u00e1 ficando bom." },
  { min: 26, max: 50, msg: "Quase na metade! Seu projeto j\u00e1 est\u00e1 tomando forma." },
  { min: 51, max: 75, msg: "Mais da metade! O plano est\u00e1 ficando completo." },
  { min: 76, max: 95, msg: "Falta pouco! Seu projeto est\u00e1 quase pronto para enviar." },
  { min: 96, max: 100, msg: "Excelente! Plano 100% preenchido. Hora de enviar!" }
];

function getMotivation(pct) {
  for (var i = 0; i < MOTIVATIONS.length; i++) {
    if (pct >= MOTIVATIONS[i].min && pct <= MOTIVATIONS[i].max) return MOTIVATIONS[i].msg;
  }
  return '';
}

/* ===================================================
   STATE
   =================================================== */
var STORAGE_KEY = 'canvas-projeto-data';
var STORAGE_STEP_KEY = 'canvas-projeto-step';
var STORAGE_SENT_KEY = 'canvas-projeto-sent';

var currentStep = 0;
var submitting = false;
var showSuccess = false;

var data = {
  responsavel_nome: "", responsavel_email: "",
  ra: "", pratica: "", projeto: "", objetivo: "", descricao: "",
  produto: "", caracteristicas: "", justificativa: "",
  indicador: "", patrocinio: "", equipe: "", publico: "",
  premissas: "", barreiras: "", riscos: "",
  entregas: [
    { entrega: "", atividades: "", prazo: "", investimento: "Sem custo direto" }
  ]
};

/* ===================================================
   LOCALSTORAGE PERSISTENCE
   =================================================== */
function loadFromStorage() {
  try {
    var saved = localStorage.getItem(STORAGE_KEY);
    if (saved) {
      var parsed = JSON.parse(saved);
      delete parsed.exportDate;
      Object.keys(parsed).forEach(function(k) { data[k] = parsed[k]; });
    }
    var savedStep = localStorage.getItem(STORAGE_STEP_KEY);
    if (savedStep) {
      var step = parseInt(savedStep, 10);
      if (!isNaN(step) && step >= 0 && step < STEPS.length) {
        currentStep = step;
      }
    }
  } catch (e) { /* ignore corrupt data */ }
}

function getSentInfo() {
  try {
    var s = localStorage.getItem(STORAGE_SENT_KEY);
    return s ? JSON.parse(s) : null;
  } catch (e) { return null; }
}

function markAsSent() {
  try {
    localStorage.setItem(STORAGE_SENT_KEY, JSON.stringify({
      timestamp: new Date().toISOString(),
      ra: data.ra,
      projeto: data.projeto
    }));
  } catch (e) { /* ignore */ }
}

var autosaveTimeout = null;
function saveToStorage() {
  try {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    localStorage.setItem(STORAGE_STEP_KEY, String(currentStep));
    showAutosaveIndicator();
  } catch (e) { /* storage full or unavailable */ }
}

function showAutosaveIndicator() {
  var el = document.getElementById('autosave-indicator');
  if (!el) return;
  el.classList.add('show');
  clearTimeout(autosaveTimeout);
  autosaveTimeout = setTimeout(function() { el.classList.remove('show'); }, 1500);
}

function scheduleAutosave() {
  saveCurrentInputs();
  saveToStorage();
}

/* ===================================================
   HELPERS
   =================================================== */
function esc(s) { var d = document.createElement('div'); d.textContent = s; return d.innerHTML; }

function getProgress() {
  var fields = [data.responsavel_nome, data.responsavel_email, data.ra, data.pratica, data.projeto, data.objetivo, data.descricao, data.produto,
    data.caracteristicas, data.justificativa, data.indicador,
    data.patrocinio, data.equipe, data.publico,
    data.premissas, data.barreiras, data.riscos];
  var ef = [];
  data.entregas.forEach(function(e) { ef.push(e.entrega, e.atividades, e.prazo, e.investimento); });
  var all = fields.concat(ef);
  var filled = all.filter(function(f) { return f && f.trim(); }).length;
  return Math.round((filled / all.length) * 100);
}

function getRequiredEmpty() {
  var required = [
    { field: 'responsavel_nome', label: 'Nome do Respons\u00e1vel' },
    { field: 'ra', label: 'Regi\u00e3o Administrativa' },
    { field: 'pratica', label: 'Pr\u00e1tica de Governan\u00e7a' },
    { field: 'projeto', label: 'Nome do Projeto' },
    { field: 'objetivo', label: 'Objetivo' }
  ];
  var empty = [];
  required.forEach(function(r) {
    if (!data[r.field] || !data[r.field].trim()) empty.push(r.label);
  });
  return empty;
}

function goTo(idx) {
  saveCurrentInputs();
  saveToStorage();
  var content = document.querySelector('.step-content');
  if (content) {
    content.classList.add('fading');
    setTimeout(function() { currentStep = idx; showSuccess = false; render(); }, 200);
  } else {
    currentStep = idx;
    showSuccess = false;
    render();
  }
}

function next() { if (currentStep < STEPS.length - 1) goTo(currentStep + 1); }
function prev() { if (currentStep > 0) goTo(currentStep - 1); }

function saveCurrentInputs() {
  var step = STEPS[currentStep];

  // Single field step
  if (step.type === 'single' && step.fieldId) {
    var el = document.getElementById('field-' + step.fieldId);
    if (el) data[step.fieldId] = el.value;
  }

  // Group step - save all fields
  if (step.type === 'group' && step.fields) {
    step.fields.forEach(function(fieldId) {
      var el = document.getElementById('field-' + fieldId);
      if (el) data[fieldId] = el.value;
    });
  }

  // Partes
  if (step.type === 'partes') {
    ['patrocinio', 'equipe', 'publico'].forEach(function(k) {
      var el = document.getElementById('field-' + k);
      if (el) data[k] = el.value;
    });
  }

  // Entregas
  if (step.type === 'entregas') {
    data.entregas.forEach(function(_, i) {
      ['entrega', 'atividades', 'prazo', 'investimento'].forEach(function(k) {
        var el = document.getElementById('ent-' + i + '-' + k);
        if (el) data.entregas[i][k] = el.value;
      });
    });
  }
}

function exportJSON() {
  saveCurrentInputs();
  saveToStorage();
  var blob = new Blob([JSON.stringify(Object.assign({}, data, { exportDate: new Date().toISOString() }), null, 2)], { type: 'application/json' });
  var url = URL.createObjectURL(blob);
  var a = document.createElement('a');
  a.href = url;
  a.download = 'plano-acao-' + (data.ra || 'cig').replace(/[^a-zA-Z0-9]/g, '-') + '-' + new Date().toISOString().slice(0,10) + '.json';
  a.click();
  URL.revokeObjectURL(url);
}

function importJSON() {
  var input = document.createElement('input');
  input.type = 'file';
  input.accept = '.json';
  input.onchange = function(e) {
    var file = e.target.files[0];
    if (!file) return;
    var reader = new FileReader();
    reader.onload = function(ev) {
      try {
        var imp = JSON.parse(ev.target.result);
        delete imp.exportDate;
        Object.keys(imp).forEach(function(k) { data[k] = imp[k]; });
        saveToStorage();
        if (currentStep === 0) currentStep = 1;
        render();
      } catch (err) { alert('Arquivo inv\u00e1lido.'); }
    };
    reader.readAsText(file);
  };
  input.click();
}

function handleExampleClick(e) {
  var card = e.currentTarget;
  var field = card.dataset.field;
  var text = card.dataset.text;
  if (!data[field] || !data[field].trim()) {
    data[field] = text;
    var el = document.getElementById('field-' + field);
    if (el) el.value = text;
    scheduleAutosave();
  } else {
    if (confirm('O campo j\u00e1 est\u00e1 preenchido. Deseja substituir pelo exemplo?')) {
      data[field] = text;
      var el = document.getElementById('field-' + field);
      if (el) el.value = text;
      scheduleAutosave();
    }
  }
}

function addEntrega() {
  saveCurrentInputs();
  data.entregas.push({ entrega: '', atividades: '', prazo: '', investimento: 'Sem custo direto' });
  saveToStorage();
  render();
}

function removeEntrega(idx) {
  if (data.entregas.length <= 1) return;
  var entry = data.entregas[idx];
  var hasContent = entry.entrega.trim() || entry.atividades.trim() || entry.prazo.trim() || (entry.investimento.trim() && entry.investimento.trim() !== 'Sem custo direto');
  if (hasContent && !confirm('Tem certeza que deseja remover a Entrega ' + (idx + 1) + '? Os dados preenchidos ser\u00e3o perdidos.')) {
    return;
  }
  saveCurrentInputs();
  data.entregas.splice(idx, 1);
  saveToStorage();
  render();
}

function clearAllData() {
  if (!confirm('Tem certeza que deseja limpar todos os dados? Esta a\u00e7\u00e3o n\u00e3o pode ser desfeita.')) return;
  localStorage.removeItem(STORAGE_KEY);
  localStorage.removeItem(STORAGE_STEP_KEY);
  localStorage.removeItem(STORAGE_SENT_KEY);
  data = {
    responsavel_nome: "", responsavel_email: "",
    ra: "", pratica: "", projeto: "", objetivo: "", descricao: "",
    produto: "", caracteristicas: "", justificativa: "",
    indicador: "", patrocinio: "", equipe: "", publico: "",
    premissas: "", barreiras: "", riscos: "",
    entregas: [
      { entrega: "", atividades: "", prazo: "", investimento: "Sem custo direto" }
    ]
  };
  currentStep = 0;
  showSuccess = false;
  render();
}

function toggleCanvasInfo() {
  var el = document.getElementById('canvas-info-content');
  var btn = document.getElementById('canvas-info-btn');
  if (!el) return;
  if (el.style.display === 'none') {
    el.style.display = 'block';
    if (btn) btn.textContent = 'Fechar explica\u00e7\u00e3o';
  } else {
    el.style.display = 'none';
    if (btn) btn.textContent = 'O que \u00e9 o Plano de A\u00e7\u00e3o do CIG?';
  }
}

function toggleAjuda(btn) {
  var content = btn.parentElement.nextElementSibling;
  if (!content || !content.classList.contains('ajuda-content')) return;
  if (content.style.display === 'none') {
    content.style.display = 'block';
    btn.textContent = 'Fechar';
  } else {
    content.style.display = 'none';
    btn.textContent = 'Saiba mais';
  }
}

/* ===================================================
   SUBMIT TO GOOGLE SHEETS
   =================================================== */
function submitToSEGOV() {
  if (submitting) return;

  saveCurrentInputs();
  saveToStorage();

  var empty = getRequiredEmpty();
  if (empty.length > 0) {
    alert('Por favor, preencha os campos obrigat\u00f3rios antes de enviar:\n\n- ' + empty.join('\n- '));
    return;
  }

  if (GOOGLE_SCRIPT_URL === 'COLE_SUA_URL_AQUI') {
    alert('O envio ainda n\u00e3o foi configurado.\n\nO administrador precisa configurar a URL do Google Apps Script.');
    return;
  }

  submitting = true;
  render();

  var payload = Object.assign({}, data, {
    submittedAt: new Date().toISOString(),
    userAgent: navigator.userAgent
  });

  fetch(GOOGLE_SCRIPT_URL, {
    method: 'POST',
    mode: 'no-cors',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(payload)
  })
  .then(function() {
    submitting = false;
    showSuccess = true;
    markAsSent();
    render();
  })
  .catch(function(err) {
    submitting = false;
    render();
    var errorEl = document.getElementById('submit-error');
    if (errorEl) {
      errorEl.style.display = 'block';
      errorEl.textContent = 'Erro ao enviar. Verifique sua conex\u00e3o e tente novamente.';
    }
  });
}

/* ===================================================
   INPUT EVENT LISTENERS
   =================================================== */
var inputDebounce = null;
function attachInputListeners() {
  document.querySelectorAll('#app textarea, #app input[type="text"], #app input[type="email"], #app select').forEach(function(el) {
    el.addEventListener('input', function() {
      clearTimeout(inputDebounce);
      inputDebounce = setTimeout(scheduleAutosave, 800);
    });
    if (el.tagName === 'SELECT') {
      el.addEventListener('change', function() {
        scheduleAutosave();
      });
    }
  });
}

/* ===================================================
   RENDERERS
   =================================================== */

/* Welcome screen - with time estimate and GDF branding */
function renderWelcome() {
  var hasSaved = localStorage.getItem(STORAGE_KEY);
  var resumeBtn = hasSaved
    ? '<button class="btn-ghost" onclick="goTo(1)">Continuar de onde parou</button>'
    : '';

  return '<div class="welcome">' +
    '<div class="welcome-logo">' +
      '<div class="welcome-logo-badge"><img src="data:image/png;base64,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" alt="GDF"></div>' +
      '<div class="welcome-logo-text">' +
        '<strong>Governo do Distrito Federal</strong>' +
        'Secretaria de Governo \u2022 Controladoria-Geral do DF' +
      '</div>' +
    '</div>' +
    '<h2>Plano de A\u00e7\u00e3o do CIG</h2>' +
    '<p>Elabore o <strong>Plano de A\u00e7\u00e3o do Comit\u00ea Interno de Governan\u00e7a</strong> da sua Regi\u00e3o Administrativa de forma guiada, passo a passo.</p>' +
    '<div class="welcome-time">\u23F1\uFE0F Preenchimento em aproximadamente 15 minutos</div>' +
    '<div class="welcome-btns">' +
      '<button class="btn-primary" onclick="next()">Come\u00e7ar o Plano de A\u00e7\u00e3o</button>' +
      resumeBtn +
    '</div>' +
    '<div class="welcome-features">' +
      '<div class="welcome-feat"><span>\uD83D\uDCDD</span> 8 etapas simples</div>' +
      '<div class="welcome-feat"><span>\uD83D\uDCBE</span> Salva automaticamente</div>' +
      '<div class="welcome-feat"><span>\uD83D\uDCA1</span> Exemplos em cada campo</div>' +
    '</div>' +
    '<div style="margin-top:24px">' +
      '<button class="welcome-info-toggle" id="canvas-info-btn" onclick="toggleCanvasInfo()">O que \u00e9 o Plano de A\u00e7\u00e3o do CIG?</button>' +
      '<div id="canvas-info-content" class="welcome-info-content" style="display:none">' +
        '<p><strong>O Plano de A\u00e7\u00e3o do CIG</strong> \u00e9 o instrumento que organiza os projetos de governan\u00e7a de cada Administra\u00e7\u00e3o Regional em uma estrutura clara e objetiva.</p>' +
        '<p>De acordo com o <strong>Modelo de Governan\u00e7a P\u00fablica do Governo do DF</strong> (Resolu\u00e7\u00e3o CGOV N\u00ba 04/2024), cada RA deve implementar pr\u00e1ticas de governan\u00e7a monitoradas pela SEGOV e pela CGDF.</p>' +
        '<p>Este formul\u00e1rio guia voc\u00ea por cada campo, com exemplos pr\u00e1ticos para inspirar. Suas respostas s\u00e3o salvas automaticamente no navegador. Ao final, o plano \u00e9 enviado diretamente para a SEGOV.</p>' +
        '<p>N\u00e3o se preocupe em acertar tudo de primeira! Voc\u00ea pode voltar e editar qualquer campo a qualquer momento.</p>' +
      '</div>' +
    '</div>' +
  '</div>';
}

/* Render a single field (used for single-type steps and inside groups) */
function renderSingleFieldInput(def, isInsideGroup) {
  var exHTML = '';
  if (def.exemplos && def.exemplos.length) {
    exHTML = '<div class="examples-label">\uD83D\uDCA1 Exemplos para inspirar</div>';
    def.exemplos.forEach(function(ex) {
      exHTML += '<div class="example-card" data-field="' + esc(def.field) + '" data-text="' + esc(ex.texto) + '" title="Clique para usar como base">' +
        '<div class="example-tag" style="color:' + def.color + '">' + esc(ex.titulo) + '</div>' +
        '<div class="example-text">' + esc(ex.texto) + '</div>' +
      '</div>';
    });
    exHTML += '<div class="examples-hint">Clique num exemplo para us\u00e1-lo como ponto de partida</div>';
  }

  var ajudaBtnHTML = def.ajuda ? ' <button class="ajuda-btn" onclick="toggleAjuda(this)">Saiba mais</button>' : '';
  var ajudaBlockHTML = def.ajuda ? '<div class="ajuda-content" style="display:none">' + esc(def.ajuda) + '</div>' : '';

  var inputHTML = '';
  if (def.inputType === 'select') {
    inputHTML = '<label class="sr-only" for="field-' + def.field + '">' + esc(def.label) + '</label>' +
      '<select id="field-' + def.field + '">' +
      '<option value="">' + esc(def.placeholder || 'Selecione...') + '</option>';
    def.opcoes.forEach(function(op) {
      inputHTML += '<option value="' + esc(op) + '"' + (data[def.field] === op ? ' selected' : '') + '>' + esc(op) + '</option>';
    });
    inputHTML += '</select>';
  } else if (def.inputType === 'input' || def.inputType === 'email') {
    var inputTypeAttr = def.inputType === 'email' ? 'email' : 'text';
    inputHTML = '<label class="sr-only" for="field-' + def.field + '">' + esc(def.label) + '</label>' +
      '<input type="' + inputTypeAttr + '" id="field-' + def.field + '" value="' + esc(data[def.field]) + '" placeholder="' + esc(def.placeholder) + '">';
  } else {
    var rows = isInsideGroup ? '4' : '5';
    inputHTML = '<label class="sr-only" for="field-' + def.field + '">' + esc(def.label) + '</label>' +
      '<textarea id="field-' + def.field + '" rows="' + rows + '" placeholder="' + esc(def.placeholder) + '">' + esc(data[def.field]) + '</textarea>';
  }

  if (isInsideGroup) {
    return '<div class="group-field">' +
      '<div class="group-field-header">' +
        '<span class="group-field-icon">' + def.icon + '</span>' +
        '<span class="group-field-label">' + esc(def.label) + '</span>' +
      '</div>' +
      '<p class="group-field-hint">' + esc(def.dica) + ajudaBtnHTML + '</p>' +
      ajudaBlockHTML +
      exHTML + inputHTML +
    '</div>';
  }

  // Full standalone render
  var reqLabel = ' <span style="color:var(--accent-red);font-size:18px" title="Campo obrigat\u00f3rio">*</span>';
  return '<span class="step-icon">' + def.icon + '</span>' +
    '<h2 class="step-question">' + esc(def.question) + reqLabel + '</h2>' +
    '<p class="step-hint">' + esc(def.dica) + ajudaBtnHTML + '</p>' +
    ajudaBlockHTML +
    exHTML + inputHTML;
}

/* Render a single-type step (one field per screen) */
function renderSingleStep(step) {
  var def = FIELD_DEFS[step.fieldId];
  if (!def) return '';
  var contextoHTML = def.contexto ? '<div class="step-contexto">' + esc(def.contexto) + '</div>' : '';
  return contextoHTML + renderSingleFieldInput(def, false);
}

/* Render a group step (multiple fields per screen) */
function renderGroup(step) {
  var contextoHTML = step.contexto ? '<div class="step-contexto">' + esc(step.contexto) + '</div>' : '';

  var html = contextoHTML +
    '<span class="step-icon">' + step.icon + '</span>' +
    '<h2 class="step-question">' + esc(step.question) + '</h2>' +
    '<p class="step-hint">' + esc(step.dica) + '</p>';

  step.fields.forEach(function(fieldId) {
    var def = FIELD_DEFS[fieldId];
    if (def) {
      html += renderSingleFieldInput(def, true);
    }
  });

  return html;
}

/* Render partes interessadas */
function renderPartes(step) {
  var contextoHTML = step.contexto ? '<div class="step-contexto">' + esc(step.contexto) + '</div>' : '';
  var ajudaBtnHTML = step.ajuda ? ' <button class="ajuda-btn" onclick="toggleAjuda(this)">Saiba mais</button>' : '';
  var ajudaBlockHTML = step.ajuda ? '<div class="ajuda-content" style="display:none">' + esc(step.ajuda) + '</div>' : '';

  var subs = [
    { key: 'patrocinio', label: 'Patroc\u00ednio e Gest\u00e3o', ph: 'Quem patrocina e gerencia?', exs: step.exemplos.patrocinio },
    { key: 'equipe', label: 'Equipe Executora', ph: 'Quem vai executar?', exs: step.exemplos.equipe },
    { key: 'publico', label: 'P\u00fablico-alvo', ph: 'Quem se beneficia?', exs: step.exemplos.publico }
  ];

  var html = contextoHTML +
    '<span class="step-icon">' + step.icon + '</span>' +
    '<h2 class="step-question">' + esc(step.question) + ' <span style="color:var(--accent-red);font-size:18px" title="Campo obrigat\u00f3rio">*</span></h2>' +
    '<p class="step-hint">' + esc(step.dica) + ajudaBtnHTML + '</p>' +
    ajudaBlockHTML;

  subs.forEach(function(s) {
    html += '<div class="partes-block">' +
      '<label class="partes-label" for="field-' + s.key + '">' + esc(s.label) + '</label>' +
      '<div class="partes-examples">\uD83D\uDCA1 Ex: ' + s.exs.map(function(e) { return esc(e); }).join(' \u2022 ') + '</div>' +
      '<textarea class="small-textarea" id="field-' + s.key + '" rows="3" placeholder="' + esc(s.ph) + '">' + esc(data[s.key]) + '</textarea>' +
    '</div>';
  });

  return html;
}

/* Render entregas with dropdown for prazo */
function renderEntregas(step) {
  var contextoHTML = step.contexto ? '<div class="step-contexto">' + esc(step.contexto) + '</div>' : '';
  var ajudaBtnHTML = step.ajuda ? ' <button class="ajuda-btn" onclick="toggleAjuda(this)">Saiba mais</button>' : '';
  var ajudaBlockHTML = step.ajuda ? '<div class="ajuda-content" style="display:none">' + esc(step.ajuda) + '</div>' : '';

  var exHTML = '';
  step.exemplos.forEach(function(ex, i) {
    exHTML += '<div style="font-size:12px;color:var(--text-secondary);line-height:1.5;padding:6px 0;' +
      (i < step.exemplos.length - 1 ? 'border-bottom:1px solid var(--border);' : '') + '">' +
      '<strong style="color:var(--gdf-blue)">Entrega ' + (i+1) + ':</strong> ' + esc(ex.entrega) +
      ' <span style="color:var(--text-muted)">\u2192 ' + esc(ex.atividades) + '</span>' +
      ' <span style="color:var(--text-secondary)">(' + esc(ex.prazo) + ')</span>' +
    '</div>';
  });

  var entregasHTML = '';
  data.entregas.forEach(function(ent, i) {
    // Build prazo select with current value handling
    var prazoIsCustom = ent.prazo && PRAZOS_OPCOES.indexOf(ent.prazo) < 0 && ent.prazo.trim() !== '';
    var prazoSelectHTML = '<select class="small-select" id="ent-' + i + '-prazo">' +
      '<option value="">Selecione o prazo...</option>';
    PRAZOS_OPCOES.forEach(function(op) {
      prazoSelectHTML += '<option value="' + esc(op) + '"' + (ent.prazo === op ? ' selected' : '') + '>' + esc(op) + '</option>';
    });
    if (prazoIsCustom) {
      prazoSelectHTML += '<option value="' + esc(ent.prazo) + '" selected>' + esc(ent.prazo) + '</option>';
    }
    prazoSelectHTML += '</select>';

    entregasHTML += '<div class="entrega-card">' +
      '<div class="entrega-header">' +
        '<span class="entrega-badge">Entrega ' + (i + 1) + '</span>' +
        (data.entregas.length > 1 ? '<button class="entrega-remove" data-idx="' + i + '">Remover</button>' : '') +
      '</div>' +
      '<div class="entrega-grid">' +
        '<div>' +
          '<label class="entrega-field-label" for="ent-' + i + '-entrega">O que ser\u00e1 entregue?</label>' +
          '<textarea class="small-textarea" id="ent-' + i + '-entrega" rows="2">' + esc(ent.entrega) + '</textarea>' +
        '</div>' +
        '<div>' +
          '<label class="entrega-field-label" for="ent-' + i + '-atividades">Atividades necess\u00e1rias</label>' +
          '<textarea class="small-textarea" id="ent-' + i + '-atividades" rows="3">' + esc(ent.atividades) + '</textarea>' +
        '</div>' +
        '<div>' +
          '<label class="entrega-field-label" for="ent-' + i + '-prazo">Prazo estimado</label>' +
          prazoSelectHTML +
        '</div>' +
        '<div>' +
          '<label class="entrega-field-label" for="ent-' + i + '-investimento">Investimento (se houver)</label>' +
          '<textarea class="small-textarea" id="ent-' + i + '-investimento" rows="1">' + esc(ent.investimento) + '</textarea>' +
        '</div>' +
      '</div>' +
    '</div>';
  });

  return contextoHTML +
    '<span class="step-icon">' + step.icon + '</span>' +
    '<h2 class="step-question">' + esc(step.question) + ' <span style="color:var(--accent-red);font-size:18px" title="Campo obrigat\u00f3rio">*</span></h2>' +
    '<p class="step-hint">' + esc(step.dica) + ajudaBtnHTML + '</p>' +
    ajudaBlockHTML +
    '<div class="entregas-example">' +
      '<div class="examples-label">\uD83D\uDCA1 Exemplo de entregas (Projeto CIG)</div>' +
      exHTML +
    '</div>' +
    entregasHTML +
    '<button class="btn-add-entrega" onclick="addEntrega()">+ Adicionar mais uma entrega</button>';
}

function renderSuccessScreen() {
  return '<div class="success-screen">' +
    '<div class="success-icon">\uD83C\uDF89</div>' +
    '<h2>Plano de A\u00e7\u00e3o enviado com sucesso!</h2>' +
    '<p>O Plano de A\u00e7\u00e3o da <strong>' + esc(data.ra || 'sua RA') + '</strong> foi recebido pela SEGOV/SEGEST.</p>' +
    (data.pratica ? '<p class="sub">Pr\u00e1tica: ' + esc(data.pratica) + '</p>' : '') +
    '<p class="sub">Projeto: ' + esc(data.projeto || '(sem nome)') + '</p>' +
    '<div class="success-badge">\u2713 Enviado em ' + new Date().toLocaleDateString('pt-BR') + ' \u00e0s ' + new Date().toLocaleTimeString('pt-BR', {hour:'2-digit',minute:'2-digit'}) + '</div>' +
    '<div class="success-actions" style="margin-top:24px">' +
      '<button class="btn-nav btn-nav-prev" onclick="showSuccess=false;render()">Voltar para revis\u00e3o</button>' +
      '<button class="btn-nav btn-nav-prev" onclick="clearAllData()">Iniciar novo plano</button>' +
    '</div>' +
  '</div>';
}

function renderReview() {
  if (showSuccess) return renderSuccessScreen();

  function getVal(item) {
    if (item.field) return data[item.field];
    if (item.type === 'partes') return [data.patrocinio, data.equipe, data.publico].filter(Boolean).join('\n');
    if (item.type === 'entregas') return data.entregas.map(function(e, i) { return (i+1) + '. ' + e.entrega; }).filter(function(e) { return e.length > 3; }).join('\n');
    return '';
  }

  var items = '';
  var lastPhase = '';
  REVIEW_ITEMS.forEach(function(item) {
    // Phase group headers
    if (item.phase !== lastPhase) {
      items += '<div class="review-group-label">' + esc(item.phase) + '</div>';
      lastPhase = item.phase;
    }

    var val = getVal(item);
    var filled = val && val.trim().length > 0;
    var stepIdx = getStepIndexForField(item.id);
    var req = isRequired(item.field || item.id);
    items += '<button class="review-item ' + (filled ? '' : (req ? 'pending' : '')) + '" data-goto="' + stepIdx + '">' +
      '<span class="review-item-icon">' + item.icon + '</span>' +
      '<div class="review-item-body">' +
        '<div class="review-item-label ' + (filled ? 'filled' : 'empty') + '">' + esc(item.label) + (filled ? '' : (req ? ' \u26A0\uFE0F Obrigat\u00f3rio' : ' (opcional)')) + '</div>' +
        '<div class="review-item-preview">' + esc(val || (req ? 'Clique para preencher...' : 'Clique para preencher (opcional)...')) + '</div>' +
      '</div>' +
      '<span class="review-edit">\u270F\uFE0F</span>' +
    '</button>';
  });

  // Submit section
  var sentInfo = getSentInfo();
  var submitHTML = '';

  if (sentInfo) {
    var sentDate = new Date(sentInfo.timestamp);
    submitHTML = '<div class="already-sent">' +
      '<p>\u2713 Plano j\u00e1 enviado em <strong>' + sentDate.toLocaleDateString('pt-BR') + '</strong> \u00e0s ' + sentDate.toLocaleTimeString('pt-BR', {hour:'2-digit',minute:'2-digit'}) + '</p>' +
      '<button class="btn-submit" onclick="submitToSEGOV()"' + (submitting ? ' disabled' : '') + '>' +
        (submitting ? '<span class="spinner"></span>Enviando...' : '\uD83D\uDD04 Reenviar vers\u00e3o atualizada') +
      '</button>' +
    '</div>';
  } else {
    submitHTML = '<div class="submit-section">' +
      '<p>Revisou tudo? Quando estiver pronto, envie o Plano de A\u00e7\u00e3o diretamente para a equipe SEGOV/SEGEST.<br><span style="font-size:11px;color:var(--text-muted)">Apenas os campos com * s\u00e3o obrigat\u00f3rios. Os demais podem ser preenchidos depois.</span></p>' +
      '<button class="btn-submit" onclick="submitToSEGOV()"' + (submitting ? ' disabled' : '') + '>' +
        (submitting ? '<span class="spinner"></span>Enviando para SEGOV...' : '\uD83D\uDCE8 Enviar Plano de A\u00e7\u00e3o para SEGOV') +
      '</button>' +
      '<div id="submit-error" class="error-msg" style="display:none"></div>' +
    '</div>';
  }

  return '<div class="review-header">' +
      '<div class="icon">\uD83D\uDCCB</div>' +
      '<h2>Revis\u00e3o do Plano de A\u00e7\u00e3o</h2>' +
      '<p>Revise as informa\u00e7\u00f5es abaixo. Clique em qualquer se\u00e7\u00e3o para editar.</p>' +
      (data.ra ? '<div class="review-ra">\uD83D\uDCCD ' + esc(data.ra) + '</div>' : '') +
      (data.pratica ? '<div class="review-ra" style="margin-top:6px;background:#f5f3ff;border-color:#c4b5fd;color:#6d28d9">\uD83C\uDFDB\uFE0F ' + esc(data.pratica) + '</div>' : '') +
    '</div>' +
    items +
    submitHTML +
    '<div class="review-actions">' +
      '<button class="btn-nav btn-nav-prev" onclick="clearAllData()">Limpar tudo e recome\u00e7ar</button>' +
    '</div>';
}

/* ===================================================
   PHASE STEPPER RENDERER
   =================================================== */
function renderPhaseStepper(pct) {
  var currentPhaseIdx = getCurrentPhaseIndex();
  var step = STEPS[currentStep];
  var isWelcome = step.type === 'welcome';
  var isReview = step.type === 'review';

  // Desktop stepper
  var desktopHTML = '<div class="phase-stepper-bar">';
  PHASES.forEach(function(phase, i) {
    var status = 'future';
    if (i < currentPhaseIdx) status = 'completed';
    else if (i === currentPhaseIdx) status = 'active';

    if (i > 0) {
      desktopHTML += '<div class="phase-connector' + (i <= currentPhaseIdx ? ' done' : '') + '"></div>';
    }

    var firstStep = getFirstStepOfPhase(i);
    var numDisplay = status === 'completed' ? '\u2713' : String(i + 1);
    desktopHTML += '<div class="phase-step-item ' + status + '" data-goto="' + firstStep + '" title="Ir para: ' + esc(phase.name) + '">' +
      '<span class="phase-step-num">' + numDisplay + '</span>' +
      '<span class="phase-step-name">' + esc(phase.name) + '</span>' +
    '</div>';
  });
  desktopHTML += '</div>';

  // Mobile: just show current phase
  var mobileLabel = isWelcome ? 'In\u00edcio' : (isReview ? 'Revis\u00e3o' : (currentPhaseIdx >= 0 ? PHASES[currentPhaseIdx].name : ''));
  var mobileHTML = '<div class="phase-stepper-mobile">' +
    'Fase: <strong>' + esc(mobileLabel) + '</strong> \u2022 Etapa ' + Math.min(currentStep, STEPS.length - 1) + ' de ' + (STEPS.length - 2) +
  '</div>';

  // Progress track
  var progressPct = isWelcome ? 0 : (isReview ? 100 : ((currentStep - 1) / (STEPS.length - 2)) * 100);
  var progressHTML = '<div class="progress-track" style="margin-top:10px"><div class="progress-fill" style="width:' + progressPct + '%"></div></div>';

  // Info line
  var infoHTML = '<div class="phase-stepper-info">' +
    '<span style="color:var(--text-secondary)">Etapa ' + Math.min(currentStep, STEPS.length - 1) + ' de ' + (STEPS.length - 2) + '</span>' +
    '<span style="font-weight:700;color:' + (pct === 100 ? 'var(--gdf-blue)' : 'var(--gdf-blue)') + '">' + pct + '% preenchido</span>' +
  '</div>';

  return '<div class="phase-stepper no-print">' +
    desktopHTML + mobileHTML + progressHTML + infoHTML +
  '</div>';
}

/* ===================================================
   MAIN RENDER
   =================================================== */
function render() {
  var step = STEPS[currentStep];
  var pct = getProgress();
  var isFirst = currentStep === 0;
  var isLast = currentStep === STEPS.length - 1;

  var contentHTML = '';
  if (step.type === 'welcome') contentHTML = renderWelcome();
  else if (step.type === 'review') contentHTML = renderReview();
  else if (step.type === 'partes') contentHTML = renderPartes(step);
  else if (step.type === 'entregas') contentHTML = renderEntregas(step);
  else if (step.type === 'group') contentHTML = renderGroup(step);
  else if (step.type === 'single') contentHTML = renderSingleStep(step);

  // Motivation message (only on form steps)
  var motivHTML = '';
  if (!isFirst && !isLast) {
    motivHTML = '<div class="motivation no-print">' + getMotivation(pct) + '</div>';
  }

  // Navigation
  var navHTML = '';
  if (!isFirst || !step.type) {
    navHTML = '<div class="nav-row no-print">';
    navHTML += isFirst ? '<div></div>' : '<button class="btn-nav btn-nav-prev" onclick="prev()">\u2190 Anterior</button>';
    if (isLast) {
      navHTML += '<button class="btn-nav btn-nav-print" onclick="window.print()">\uD83D\uDDA8\uFE0F Imprimir / Gerar PDF</button>';
    } else {
      navHTML += '<button class="btn-nav btn-nav-next" onclick="next()">Pr\u00f3ximo \u2192</button>';
    }
    navHTML += '</div>';
  }

  document.getElementById('app').innerHTML =
    '<div class="header no-print">' +
      '<div class="header-brand">' +
        '<div class="gdf-badge"><img src="data:image/png;base64,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" alt="GDF"></div>' +
        '<div class="header-brand-text">' +
          '<span>Secretaria de Governo \u2022 Controladoria-Geral do DF</span>' +
          '<h1>Plano de A\u00e7\u00e3o do CIG</h1>' +
        '</div>' +
      '</div>' +
    '</div>' +
    renderPhaseStepper(pct) +
    motivHTML +
    '<div class="step-card">' +
      '<div class="step-content">' + contentHTML + '</div>' +
    '</div>' +
    navHTML +
    '<div class="footer">' +
      'Plano de A\u00e7\u00e3o do CIG \u2022 Administra\u00e7\u00f5es Regionais do DF<br>' +
      'Secretaria de Governo \u2022 Controladoria-Geral do DF<br>' +
      'Modelo de Governan\u00e7a P\u00fablica do DF \u2014 Resolu\u00e7\u00e3o CGOV N\u00ba 04/2024' +
    '</div>';

  // Attach event listeners
  attachInputListeners();
  attachClickListeners();
}

function attachClickListeners() {
  // Example cards
  document.querySelectorAll('.example-card[data-field]').forEach(function(card) {
    card.addEventListener('click', handleExampleClick);
  });

  // Navigation: phase stepper items, review items, etc.
  document.querySelectorAll('[data-goto]').forEach(function(el) {
    el.addEventListener('click', function() {
      goTo(parseInt(el.dataset.goto, 10));
    });
  });

  // Entrega remove buttons
  document.querySelectorAll('.entrega-remove[data-idx]').forEach(function(btn) {
    btn.addEventListener('click', function() {
      removeEntrega(parseInt(btn.dataset.idx, 10));
    });
  });

  // Enter key on single-line input or select advances to next step
  document.querySelectorAll('#app input[type="text"], #app input[type="email"], #app select').forEach(function(el) {
    el.addEventListener('keydown', function(e) {
      if (e.key === 'Enter') { e.preventDefault(); next(); }
    });
  });
}

// Screen-reader only class
var styleEl = document.createElement('style');
styleEl.textContent = '.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}';
document.head.appendChild(styleEl);

// Init
loadFromStorage();
render();
</script>
</body>
</html>
