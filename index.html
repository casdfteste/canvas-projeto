<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Canvas de Projeto â€” SEGOV/SEGEST</title>
<meta name="description" content="Ferramenta guiada para elaboraÃ§Ã£o do Canvas de Projeto das AdministraÃ§Ãµes Regionais do DF">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@300;400;600;700;900&display=swap" rel="stylesheet">
<style>
  :root {
    --bg-deep: #0f172a;
    --bg-card: #1e293b;
    --bg-input: #0f172a;
    --border: #334155;
    --text-primary: #f1f5f9;
    --text-secondary: #94a3b8;
    --text-muted: #64748b;
    --text-dim: #475569;
    --accent-blue: #3b82f6;
    --accent-blue-dark: #2563eb;
    --accent-green: #34d399;
    --accent-green-dark: #059669;
    --accent-yellow: #fbbf24;
    --accent-red: #ef4444;
    --accent-red-bg: #7f1d1d;
    --radius: 12px;
    --radius-sm: 8px;
    --font: 'Source Sans 3', 'Segoe UI', system-ui, sans-serif;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: var(--font);
    background: linear-gradient(160deg, var(--bg-deep) 0%, var(--bg-card) 40%, var(--bg-deep) 100%);
    color: var(--text-primary);
    min-height: 100vh;
    padding: 24px 16px;
    -webkit-font-smoothing: antialiased;
  }

  ::selection { background: var(--accent-blue); color: #fff; }

  .container { max-width: 780px; margin: 0 auto; }

  /* Header */
  .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 12px; }
  .header-brand span { font-size: 10px; font-weight: 700; letter-spacing: 0.2em; color: var(--text-muted); text-transform: uppercase; }
  .header-brand h1 { font-size: 22px; font-weight: 900; color: var(--text-primary); letter-spacing: -0.02em; margin-top: 4px; }
  .header-actions { display: flex; gap: 8px; }

  /* Buttons */
  .btn-small {
    padding: 6px 14px; border-radius: var(--radius-sm); border: 1px solid var(--border);
    background: var(--bg-card); color: var(--text-secondary); font-size: 12px;
    font-weight: 600; cursor: pointer; font-family: var(--font); transition: all 0.2s;
  }
  .btn-small:hover { background: var(--border); color: var(--text-primary); }

  .btn-nav {
    padding: 12px 28px; border-radius: 10px; font-size: 14px; font-weight: 700;
    cursor: pointer; font-family: var(--font); transition: all 0.2s; border: none;
  }
  .btn-nav-next { background: var(--accent-blue-dark); color: #fff; }
  .btn-nav-next:hover { background: var(--accent-blue); }
  .btn-nav-prev { background: var(--border); color: var(--text-secondary); border: 1.5px solid var(--text-dim); }
  .btn-nav-prev:hover { background: var(--text-dim); color: var(--text-primary); }
  .btn-nav-print { background: var(--accent-green-dark); color: #fff; }
  .btn-nav-print:hover { background: var(--accent-green); }

  .btn-primary {
    padding: 14px 36px; border-radius: var(--radius); border: none;
    background: linear-gradient(135deg, var(--accent-blue-dark), var(--accent-blue));
    color: #fff; font-size: 16px; font-weight: 700; cursor: pointer;
    box-shadow: 0 4px 20px rgba(37,99,235,0.3); font-family: var(--font); transition: transform 0.2s;
  }
  .btn-primary:hover { transform: translateY(-1px); }

  .btn-ghost {
    padding: 14px 24px; border-radius: var(--radius); border: 1.5px solid var(--border);
    background: transparent; color: var(--text-secondary); font-size: 14px;
    font-weight: 600; cursor: pointer; font-family: var(--font);
  }
  .btn-ghost:hover { background: var(--bg-card); }

  /* Progress */
  .progress-bar { margin-bottom: 20px; }
  .progress-info { display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 12px; }
  .progress-track { height: 4px; background: var(--border); border-radius: 2px; overflow: hidden; }
  .progress-fill { height: 100%; background: linear-gradient(90deg, var(--accent-blue), var(--accent-green)); border-radius: 2px; transition: width 0.4s ease; }
  .progress-dots { display: flex; gap: 3px; margin-top: 8px; justify-content: center; flex-wrap: wrap; }
  .progress-dot {
    height: 8px; border-radius: 4px; border: none; cursor: pointer;
    transition: all 0.3s ease; padding: 0;
  }
  .progress-dot-active { width: 24px; background: var(--accent-blue); }
  .progress-dot-done { width: 8px; background: var(--accent-green); }
  .progress-dot-todo { width: 8px; background: var(--border); }
  .progress-dot:hover { opacity: 0.8; }

  /* Navigation */
  .nav-row { display: flex; justify-content: space-between; margin-top: 24px; gap: 12px; }

  /* Content area */
  .step-content { transition: opacity 0.2s ease, transform 0.2s ease; }
  .step-content.fading { opacity: 0; transform: translateY(12px); }

  /* Question styling */
  .step-icon { font-size: 36px; display: block; margin-bottom: 8px; }
  .step-question { font-size: 24px; font-weight: 800; color: var(--text-primary); margin-bottom: 6px; letter-spacing: -0.01em; }
  .step-hint { font-size: 14px; color: var(--text-secondary); line-height: 1.6; margin-bottom: 20px; }

  /* Examples */
  .examples-label { font-size: 11px; font-weight: 700; color: var(--accent-yellow); letter-spacing: 0.1em; text-transform: uppercase; margin-bottom: 8px; }
  .example-card {
    background: var(--bg-card); border: 1px solid var(--border); border-radius: 10px;
    padding: 10px 14px; cursor: pointer; transition: all 0.2s; margin-bottom: 8px;
  }
  .example-card:hover { border-color: var(--accent-blue); background: #1a2744; }
  .example-tag { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 3px; }
  .example-text { font-size: 13px; color: #cbd5e1; line-height: 1.55; }
  .examples-hint { font-size: 11px; color: var(--text-dim); margin-top: 6px; font-style: italic; margin-bottom: 16px; }

  /* Inputs */
  textarea, input[type="text"] {
    width: 100%; background: var(--bg-input); border: 2px solid var(--border);
    border-radius: var(--radius); padding: 14px 18px; font-size: 15px;
    color: var(--text-primary); line-height: 1.7; font-family: var(--font);
    resize: vertical; transition: border-color 0.2s; outline: none;
  }
  textarea:focus, input[type="text"]:focus { border-color: var(--accent-blue); }
  input[type="text"] { font-size: 16px; font-weight: 600; }

  textarea.small-textarea {
    font-size: 13.5px; padding: 10px 14px; border-radius: var(--radius-sm);
    border-width: 1.5px;
  }

  /* Partes interessadas */
  .partes-block {
    background: var(--bg-card); border-radius: var(--radius); padding: 16px;
    border: 1px solid var(--border); margin-bottom: 12px;
  }
  .partes-label { font-size: 12px; font-weight: 700; color: var(--text-primary); text-transform: uppercase; letter-spacing: 0.06em; margin-bottom: 4px; }
  .partes-examples { font-size: 11px; color: var(--accent-yellow); margin-bottom: 8px; }

  /* Entregas */
  .entrega-card {
    background: var(--bg-input); border: 1.5px solid var(--border); border-radius: var(--radius);
    padding: 16px; margin-bottom: 12px;
  }
  .entrega-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
  .entrega-badge { font-size: 12px; font-weight: 700; color: var(--accent-green); background: #052e16; padding: 3px 12px; border-radius: 20px; }
  .entrega-remove { background: none; border: none; color: var(--accent-red); font-size: 11px; font-weight: 600; cursor: pointer; font-family: var(--font); }
  .entrega-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  .entrega-field-label { font-size: 10px; font-weight: 700; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.06em; margin-bottom: 4px; }

  .btn-add-entrega {
    width: 100%; padding: 10px; border-radius: 10px; border: 1.5px dashed var(--border);
    background: transparent; color: var(--text-muted); font-size: 13px; font-weight: 600;
    cursor: pointer; font-family: var(--font); transition: all 0.2s;
  }
  .btn-add-entrega:hover { background: var(--bg-card); color: var(--text-secondary); }

  /* Example block in entregas */
  .entregas-example {
    background: var(--bg-card); border: 1px solid var(--border); border-radius: 10px;
    padding: 14px; margin-bottom: 16px;
  }

  /* Welcome */
  .welcome { text-align: center; padding: 40px 0; }
  .welcome-icon { font-size: 56px; margin-bottom: 16px; }
  .welcome h2 { font-size: 28px; font-weight: 900; margin-bottom: 12px; letter-spacing: -0.02em; }
  .welcome p { font-size: 16px; color: var(--text-secondary); max-width: 520px; margin: 0 auto 8px; line-height: 1.7; }
  .welcome .sub { font-size: 14px; color: var(--text-muted); max-width: 480px; margin: 0 auto 32px; line-height: 1.6; }
  .welcome-btns { display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; }
  .welcome-features { display: flex; gap: 24px; justify-content: center; margin-top: 40px; flex-wrap: wrap; }
  .welcome-feat { display: flex; align-items: center; gap: 8px; font-size: 13px; color: var(--text-muted); }
  .welcome-feat span { font-size: 18px; }

  /* Review */
  .review-header { text-align: center; margin-bottom: 28px; }
  .review-header .icon { font-size: 48px; margin-bottom: 8px; }
  .review-header h2 { font-size: 26px; font-weight: 900; margin-bottom: 6px; }
  .review-header p { font-size: 14px; color: var(--text-secondary); }
  .review-ra { display: inline-block; margin-top: 12px; padding: 6px 18px; background: #1e3a5f; border-radius: 20px; font-size: 14px; font-weight: 700; color: var(--accent-blue); }

  .review-item {
    display: flex; align-items: flex-start; gap: 12px;
    background: var(--bg-input); border: 1px solid var(--border); border-radius: 10px;
    padding: 12px 16px; cursor: pointer; width: 100%; text-align: left;
    transition: all 0.2s; font-family: var(--font); margin-bottom: 8px;
  }
  .review-item:hover { border-color: var(--accent-blue); }
  .review-item.pending { background: #1a0a0a; border-color: var(--accent-red-bg); }
  .review-item-icon { font-size: 20px; flex-shrink: 0; }
  .review-item-body { flex: 1; min-width: 0; }
  .review-item-label { font-size: 12px; font-weight: 700; margin-bottom: 2px; }
  .review-item-label.filled { color: var(--text-primary); }
  .review-item-label.empty { color: #fca5a5; }
  .review-item-preview {
    font-size: 12px; color: var(--text-muted); overflow: hidden;
    display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;
    white-space: pre-wrap; line-height: 1.5;
  }
  .review-edit { color: var(--text-dim); font-size: 16px; flex-shrink: 0; }
  .review-actions { display: flex; gap: 10px; justify-content: center; margin-top: 28px; flex-wrap: wrap; }

  /* Footer */
  .footer { text-align: center; font-size: 10px; color: var(--text-dim); margin-top: 32px; padding-top: 16px; border-top: 1px solid var(--bg-card); line-height: 1.6; }

  /* Print styles */
  @media print {
    body { background: #fff !important; color: #000 !important; padding: 16px; }
    .no-print { display: none !important; }
    .container { max-width: 100%; }
    textarea, input[type="text"] { border: 1px solid #ccc !important; background: #fff !important; color: #000 !important; min-height: 30px !important; font-size: 12px !important; }
    .step-question { color: #000 !important; font-size: 16px !important; }
    .step-hint { color: #333 !important; font-size: 11px !important; }
    .step-icon { font-size: 20px !important; }
    .review-item { background: #f9f9f9 !important; border-color: #ddd !important; }
    .review-item-label { color: #000 !important; }
    .review-item-preview { color: #333 !important; }
    .footer { color: #999 !important; border-top-color: #ddd !important; }
    .header-brand h1 { color: #000 !important; }
    .header-brand span { color: #666 !important; }
    .review-ra { background: #e0e7ff !important; color: #1e40af !important; }
  }

  /* Responsive */
  @media (max-width: 600px) {
    .welcome h2 { font-size: 22px; }
    .step-question { font-size: 20px; }
    .entrega-grid { grid-template-columns: 1fr; }
    .welcome-features { flex-direction: column; align-items: center; }
    .nav-row { flex-direction: column; }
    .btn-nav { width: 100%; text-align: center; }
    .review-actions { flex-direction: column; }
    .review-actions button { width: 100%; text-align: center; }
  }
</style>
</head>
<body>

<div class="container" id="app"></div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STEPS DATA
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const STEPS = [
  { id: "welcome", type: "welcome" },
  {
    id: "ra", field: "ra", label: "RegiÃ£o Administrativa",
    question: "Qual Ã© a sua RegiÃ£o Administrativa?",
    dica: "Identifique sua RA para personalizar o canvas.",
    placeholder: "Ex: RA-IX CeilÃ¢ndia",
    icon: "ğŸ“", color: "#3b82f6", inputType: "input", exemplos: []
  },
  {
    id: "projeto", field: "projeto", label: "Nome do Projeto",
    question: "Qual Ã© o nome do seu projeto?",
    dica: "Escolha um nome claro e direto. Inclua a sigla da RA para facilitar a identificaÃ§Ã£o.",
    placeholder: "Digite o nome do projeto...",
    icon: "ğŸ¯", color: "#3b82f6",
    exemplos: [
      { titulo: "GovernanÃ§a", texto: "ImplantaÃ§Ã£o do ComitÃª Interno de GovernanÃ§a (CIG) da RA-IX" },
      { titulo: "Atendimento", texto: "ModernizaÃ§Ã£o do Atendimento ao CidadÃ£o na RA-III Taguatinga" },
      { titulo: "GestÃ£o de Riscos", texto: "Programa de GestÃ£o de Riscos Operacionais da RA-I BrasÃ­lia" },
      { titulo: "TransparÃªncia", texto: "Portal de TransparÃªncia e PrestaÃ§Ã£o de Contas da RA-V Sobradinho" }
    ]
  },
  {
    id: "objetivo", field: "objetivo", label: "Objetivo do Projeto",
    question: "O que este projeto pretende alcanÃ§ar?",
    dica: "Descreva o resultado final desejado. Use verbos no infinitivo: estruturar, implantar, reduzir, melhorar...",
    placeholder: "Descreva o objetivo principal...",
    icon: "ğŸ†", color: "#dc2626",
    exemplos: [
      { titulo: "GovernanÃ§a", texto: "Estruturar o CIG como instÃ¢ncia deliberativa para qualificar decisÃµes e dar seguranÃ§a jurÃ­dica Ã  gestÃ£o da RA" },
      { titulo: "Atendimento", texto: "Reduzir em 50% o tempo de espera do cidadÃ£o e implantar sistema de agendamento online" },
      { titulo: "Contratos", texto: "Garantir 100% de conformidade na fiscalizaÃ§Ã£o de contratos vigentes da RA" }
    ]
  },
  {
    id: "descricao", field: "descricao", label: "DescriÃ§Ã£o do Projeto",
    question: "Descreva brevemente o projeto.",
    dica: "Contextualize: o que serÃ¡ feito, qual a abrangÃªncia, e a quais diretrizes estÃ¡ vinculado.",
    placeholder: "Descreva o escopo e contexto...",
    icon: "ğŸ“‹", color: "#2563eb",
    exemplos: [
      { titulo: "GovernanÃ§a", texto: "FormalizaÃ§Ã£o do CIG por portaria, elaboraÃ§Ã£o de regimento interno, capacitaÃ§Ã£o dos membros e inÃ­cio das reuniÃµes ordinÃ¡rias mensais, alinhado Ã s diretrizes SEGOV/CGDF" },
      { titulo: "CapacitaÃ§Ã£o", texto: "Programa de capacitaÃ§Ã£o continuada para 45 servidores da RA em gestÃ£o pÃºblica, integridade e atendimento, com 6 mÃ³dulos ao longo de 12 meses" }
    ]
  },
  {
    id: "produto", field: "produto", label: "Produto Principal",
    question: "Qual Ã© o resultado concreto que serÃ¡ entregue?",
    dica: "Pense em algo tangÃ­vel â€” que se possa apontar e dizer: \"isto foi entregue\".",
    placeholder: "O principal produto do projeto...",
    icon: "ğŸ“¦", color: "#ea580c",
    exemplos: [
      { titulo: "GovernanÃ§a", texto: "CIG formalmente instituÃ­do, com regimento aprovado e reuniÃµes ordinÃ¡rias em funcionamento" },
      { titulo: "Atendimento", texto: "Central de atendimento reorganizada com sistema de senhas, agendamento e pesquisa de satisfaÃ§Ã£o" },
      { titulo: "Riscos", texto: "Matriz de riscos da RA elaborada com planos de tratamento para os 10 riscos prioritÃ¡rios" }
    ]
  },
  {
    id: "caracteristicas", field: "caracteristicas", label: "CaracterÃ­sticas",
    question: "Quais sÃ£o as caracterÃ­sticas essenciais desse produto?",
    dica: "Liste as qualidades que tornam o produto completo e funcional.",
    placeholder: "CaracterÃ­sticas do produto principal...",
    icon: "â­", color: "#7c3aed",
    exemplos: [
      { titulo: "CIG", texto: "ComposiÃ§Ã£o multissetorial â€¢ ReuniÃµes mensais com ata no SEI â€¢ Pauta estruturada â€¢ DeliberaÃ§Ãµes registradas â€¢ Alinhamento SEGOV/CGDF" },
      { titulo: "Atendimento", texto: "AcessÃ­vel a PCD â€¢ BilÃ­ngue (portuguÃªs/Libras) â€¢ Tempo mÃ¡ximo de espera: 15min â€¢ Pesquisa de satisfaÃ§Ã£o digital" }
    ]
  },
  {
    id: "justificativa", field: "justificativa", label: "Justificativa",
    question: "Por que este projeto Ã© necessÃ¡rio?",
    dica: "Responda: qual problema resolve? Que risco evita? Por que agora? Traga dados se possÃ­vel.",
    placeholder: "O que motiva este projeto...",
    icon: "âœ…", color: "#059669",
    exemplos: [
      { titulo: "GovernanÃ§a", texto: "A ausÃªncia de instÃ¢ncia formal de governanÃ§a expÃµe a gestÃ£o a riscos em auditorias do TCDF. As oficinas SEGOV/CGDF criaram a base tÃ©cnica para implementaÃ§Ã£o imediata." },
      { titulo: "Atendimento", texto: "Pesquisa da Ouvidoria indica que 67% das reclamaÃ§Ãµes referem-se a tempo de espera. A RA atende 12 mil cidadÃ£os/mÃªs sem sistema de organizaÃ§Ã£o." }
    ]
  },
  {
    id: "indicador", field: "indicador", label: "Indicador de Resultado",
    question: "Como vocÃª vai medir o sucesso?",
    dica: "Defina mÃ©tricas concretas: percentuais, quantidades, prazos. Se o projeto der certo, que nÃºmero muda?",
    placeholder: "Indicadores de sucesso...",
    icon: "ğŸ“Š", color: "#059669",
    exemplos: [
      { titulo: "GovernanÃ§a", texto: "% de reuniÃµes realizadas vs. programadas (meta: 100%)\nNÂº de riscos identificados e tratados\nÃndice de conformidade no checklist CGDF" },
      { titulo: "Atendimento", texto: "Tempo mÃ©dio de espera (meta: < 15min)\nÃndice de satisfaÃ§Ã£o do cidadÃ£o (meta: > 80%)\nNÂº de atendimentos/dia" }
    ]
  },
  {
    id: "partes", type: "partes", label: "Partes Interessadas",
    question: "Quem estÃ¡ envolvido no projeto?",
    icon: "ğŸ‘¥", color: "#334155",
    dica: "Identifique quem patrocina, quem executa e quem se beneficia.",
    exemplos: {
      patrocinio: ["Administrador(a) Regional (patrocinador)", "Chefe de Gabinete (gestor do projeto)"],
      equipe: ["Membros do CIG capacitados nas oficinas", "Representantes das coordenaÃ§Ãµes", "Assessoria jurÃ­dica da RA"],
      publico: ["Diretos: servidores e gestores da RA", "Indiretos: populaÃ§Ã£o da regiÃ£o administrativa", "Ã“rgÃ£os de controle: TCDF, CGDF"]
    }
  },
  {
    id: "entregas", type: "entregas", label: "Entregas IntermediÃ¡rias",
    question: "Quebre o projeto em etapas â€” o que serÃ¡ entregue em cada uma?",
    icon: "ğŸ“…", color: "#059669",
    dica: "Cada entrega deve ter: o que serÃ¡ entregue, as atividades necessÃ¡rias, prazo e custo estimado. Comece com 2 a 4 entregas.",
    exemplos: [
      { entrega: "Ato normativo do CIG publicado", atividades: "Minutar portaria â†’ Assessoria jurÃ­dica â†’ Assinatura â†’ DODF", prazo: "30 dias", investimento: "Sem custo direto" },
      { entrega: "1Âª reuniÃ£o ordinÃ¡ria realizada", atividades: "Regimento aprovado â†’ Pauta definida â†’ ConvocaÃ§Ã£o â†’ Ata no SEI", prazo: "60 dias", investimento: "Sem custo direto" }
    ]
  },
  {
    id: "premissas", field: "premissas", label: "Premissas",
    question: "O que precisa dar certo para o projeto funcionar?",
    dica: "SÃ£o condiÃ§Ãµes que vocÃª assume como verdadeiras. Se alguma falhar, o projeto fica comprometido.",
    placeholder: "Fatores crÃ­ticos de sucesso...",
    icon: "ğŸ…", color: "#b45309",
    exemplos: [
      { titulo: "TÃ­picas", texto: "Apoio do(a) Administrador(a) Regional\nServidores capacitados com disponibilidade de tempo\nAcesso ao SEI funcionando\nSuporte tÃ©cnico da SEGOV conforme comprometido" }
    ]
  },
  {
    id: "barreiras", field: "barreiras", label: "Barreiras",
    question: "Quais dificuldades jÃ¡ existem hoje?",
    dica: "Diferente de riscos, barreiras sÃ£o obstÃ¡culos conhecidos e atuais â€” coisas que jÃ¡ atrapalham.",
    placeholder: "Dificuldades existentes...",
    icon: "ğŸš§", color: "#dc2626",
    exemplos: [
      { titulo: "Comuns nas RAs", texto: "AcÃºmulo de funÃ§Ãµes dos servidores\nResistÃªncia cultural a mudanÃ§as\nRotatividade em cargos comissionados\nInfraestrutura limitada (salas, equipamentos)" }
    ]
  },
  {
    id: "riscos", field: "riscos", label: "Riscos",
    question: "O que pode dar errado no futuro?",
    dica: "Eventos incertos mas possÃ­veis. Pense: \"e se acontecer X, como impacta o projeto?\"",
    placeholder: "Eventos que podem impactar...",
    icon: "âš ï¸", color: "#d97706",
    exemplos: [
      { titulo: "Frequentes", texto: "Troca de Administrador(a) com descontinuidade\nPerda de servidores capacitados por remoÃ§Ã£o\nSobrecarga de demandas urgentes\nCorte orÃ§amentÃ¡rio inesperado" }
    ]
  },
  { id: "review", type: "review" }
];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let currentStep = 0;
let data = {
  ra: "", projeto: "", objetivo: "", descricao: "",
  produto: "", caracteristicas: "", justificativa: "",
  indicador: "", patrocinio: "", equipe: "", publico: "",
  premissas: "", barreiras: "", riscos: "",
  entregas: [
    { entrega: "", atividades: "", prazo: "", investimento: "" },
    { entrega: "", atividades: "", prazo: "", investimento: "" }
  ]
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HELPERS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function esc(s) { const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }

function getProgress() {
  const fields = [data.ra, data.projeto, data.objetivo, data.descricao, data.produto,
    data.caracteristicas, data.justificativa, data.indicador,
    data.patrocinio, data.equipe, data.publico,
    data.premissas, data.barreiras, data.riscos];
  const ef = data.entregas.flatMap(e => [e.entrega, e.atividades]);
  const all = [...fields, ...ef];
  const filled = all.filter(f => f && f.trim()).length;
  return Math.round((filled / all.length) * 100);
}

function goTo(idx) {
  saveCurrentInputs();
  const content = document.querySelector('.step-content');
  if (content) {
    content.classList.add('fading');
    setTimeout(() => { currentStep = idx; render(); }, 200);
  } else {
    currentStep = idx;
    render();
  }
}

function next() { if (currentStep < STEPS.length - 1) goTo(currentStep + 1); }
function prev() { if (currentStep > 0) goTo(currentStep - 1); }

function saveCurrentInputs() {
  const step = STEPS[currentStep];
  if (step.field) {
    const el = document.getElementById('field-' + step.field);
    if (el) data[step.field] = el.value;
  }
  if (step.type === 'partes') {
    ['patrocinio', 'equipe', 'publico'].forEach(k => {
      const el = document.getElementById('field-' + k);
      if (el) data[k] = el.value;
    });
  }
  if (step.type === 'entregas') {
    data.entregas.forEach((_, i) => {
      ['entrega', 'atividades', 'prazo', 'investimento'].forEach(k => {
        const el = document.getElementById('ent-' + i + '-' + k);
        if (el) data.entregas[i][k] = el.value;
      });
    });
  }
}

function exportJSON() {
  saveCurrentInputs();
  const blob = new Blob([JSON.stringify({ ...data, exportDate: new Date().toISOString() }, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'canvas-' + (data.ra || 'projeto').replace(/[^a-zA-Z0-9]/g, '-') + '-' + new Date().toISOString().slice(0,10) + '.json';
  a.click();
  URL.revokeObjectURL(url);
}

function importJSON() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = '.json';
  input.onchange = (e) => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (ev) => {
      try {
        const imp = JSON.parse(ev.target.result);
        const { exportDate, ...rest } = imp;
        Object.assign(data, rest);
        if (currentStep === 0) currentStep = 1;
        render();
      } catch { alert('Arquivo invÃ¡lido.'); }
    };
    reader.readAsText(file);
  };
  input.click();
}

function useExample(field, text) {
  if (!data[field] || !data[field].trim()) {
    data[field] = text;
    const el = document.getElementById('field-' + field);
    if (el) el.value = text;
  }
}

function addEntrega() {
  saveCurrentInputs();
  data.entregas.push({ entrega: '', atividades: '', prazo: '', investimento: '' });
  render();
}

function removeEntrega(idx) {
  saveCurrentInputs();
  if (data.entregas.length > 1) {
    data.entregas.splice(idx, 1);
    render();
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RENDERERS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderWelcome() {
  return `
    <div class="welcome">
      <div class="welcome-icon">ğŸ—ºï¸</div>
      <h2>Vamos construir o seu projeto!</h2>
      <p>Este assistente vai guiar vocÃª, passo a passo, no preenchimento do Canvas de Projeto da sua RegiÃ£o Administrativa.</p>
      <p class="sub">Em cada etapa vocÃª verÃ¡ <strong style="color:var(--accent-yellow)">exemplos inspiradores</strong> de diferentes tipos de projeto para ajudar a pensar no seu. Leve o tempo que precisar â€” vocÃª pode salvar e continuar depois.</p>
      <div class="welcome-btns">
        <button class="btn-primary" onclick="next()">ComeÃ§ar âœ¨</button>
        <button class="btn-ghost" onclick="importJSON()">ğŸ“‚ Continuar preenchimento salvo</button>
      </div>
      <div class="welcome-features">
        <div class="welcome-feat"><span>ğŸ’¡</span> Exemplos em cada passo</div>
        <div class="welcome-feat"><span>ğŸ’¾</span> Salve e continue depois</div>
        <div class="welcome-feat"><span>ğŸ–¨ï¸</span> Exporte em PDF para o SEI</div>
      </div>
    </div>`;
}

function renderField(step) {
  let exHTML = '';
  if (step.exemplos && step.exemplos.length) {
    exHTML = `
      <div class="examples-label">ğŸ’¡ Exemplos para inspirar</div>
      ${step.exemplos.map(ex => `
        <div class="example-card" onclick="useExample('${step.field}', ${JSON.stringify(ex.texto).replace(/'/g, "\\'")})" title="Clique para usar como base (campo vazio)">
          <div class="example-tag" style="color:${step.color}">${esc(ex.titulo)}</div>
          <div class="example-text">${esc(ex.texto)}</div>
        </div>
      `).join('')}
      <div class="examples-hint">Clique num exemplo para usÃ¡-lo como ponto de partida (campo vazio) ou escreva o seu abaixo</div>
    `;
  }

  const inputHTML = step.inputType === 'input'
    ? `<input type="text" id="field-${step.field}" value="${esc(data[step.field])}" placeholder="${esc(step.placeholder)}">`
    : `<textarea id="field-${step.field}" rows="5" placeholder="${esc(step.placeholder)}">${esc(data[step.field])}</textarea>`;

  return `
    <span class="step-icon">${step.icon}</span>
    <h2 class="step-question">${esc(step.question)}</h2>
    <p class="step-hint">${esc(step.dica)}</p>
    ${exHTML}
    ${inputHTML}
  `;
}

function renderPartes(step) {
  const subs = [
    { key: 'patrocinio', label: 'PatrocÃ­nio e GestÃ£o', ph: 'Quem patrocina e gerencia?', exs: step.exemplos.patrocinio },
    { key: 'equipe', label: 'Equipe Executora', ph: 'Quem vai executar?', exs: step.exemplos.equipe },
    { key: 'publico', label: 'PÃºblico-alvo', ph: 'Quem se beneficia?', exs: step.exemplos.publico }
  ];

  return `
    <span class="step-icon">${step.icon}</span>
    <h2 class="step-question">${esc(step.question)}</h2>
    <p class="step-hint">${esc(step.dica)}</p>
    ${subs.map(s => `
      <div class="partes-block">
        <div class="partes-label">${esc(s.label)}</div>
        <div class="partes-examples">ğŸ’¡ Ex: ${s.exs.map(e => esc(e)).join(' â€¢ ')}</div>
        <textarea class="small-textarea" id="field-${s.key}" rows="3" placeholder="${esc(s.ph)}">${esc(data[s.key])}</textarea>
      </div>
    `).join('')}
  `;
}

function renderEntregas(step) {
  const exHTML = step.exemplos.map((ex, i) => `
    <div style="font-size:12px;color:#cbd5e1;line-height:1.5;padding:6px 0;${i < step.exemplos.length - 1 ? 'border-bottom:1px solid var(--border);' : ''}">
      <strong style="color:var(--accent-green)">Entrega ${i+1}:</strong> ${esc(ex.entrega)}
      <span style="color:var(--text-muted)"> â†’ ${esc(ex.atividades)}</span>
      <span style="color:var(--text-secondary)"> (${esc(ex.prazo)})</span>
    </div>
  `).join('');

  const entregasHTML = data.entregas.map((ent, i) => `
    <div class="entrega-card">
      <div class="entrega-header">
        <span class="entrega-badge">Entrega ${i + 1}</span>
        ${data.entregas.length > 1 ? `<button class="entrega-remove" onclick="removeEntrega(${i})">âœ• Remover</button>` : ''}
      </div>
      <div class="entrega-grid">
        <div>
          <div class="entrega-field-label">O que serÃ¡ entregue?</div>
          <textarea class="small-textarea" id="ent-${i}-entrega" rows="2">${esc(ent.entrega)}</textarea>
        </div>
        <div>
          <div class="entrega-field-label">Atividades necessÃ¡rias</div>
          <textarea class="small-textarea" id="ent-${i}-atividades" rows="3">${esc(ent.atividades)}</textarea>
        </div>
        <div>
          <div class="entrega-field-label">Prazo estimado</div>
          <textarea class="small-textarea" id="ent-${i}-prazo" rows="1">${esc(ent.prazo)}</textarea>
        </div>
        <div>
          <div class="entrega-field-label">Investimento</div>
          <textarea class="small-textarea" id="ent-${i}-investimento" rows="1">${esc(ent.investimento)}</textarea>
        </div>
      </div>
    </div>
  `).join('');

  return `
    <span class="step-icon">${step.icon}</span>
    <h2 class="step-question">${esc(step.question)}</h2>
    <p class="step-hint">${esc(step.dica)}</p>
    <div class="entregas-example">
      <div class="examples-label">ğŸ’¡ Exemplo de entregas (Projeto CIG)</div>
      ${exHTML}
    </div>
    ${entregasHTML}
    <button class="btn-add-entrega" onclick="addEntrega()">ï¼‹ Adicionar mais uma entrega</button>
  `;
}

function renderReview() {
  const sections = STEPS.filter(s => s.field || s.type === 'partes' || s.type === 'entregas');

  function getVal(s) {
    if (s.field) return data[s.field];
    if (s.type === 'partes') return [data.patrocinio, data.equipe, data.publico].filter(Boolean).join('\n');
    if (s.type === 'entregas') return data.entregas.map((e, i) => (i+1) + '. ' + e.entrega).filter(e => e.length > 3).join('\n');
    return '';
  }

  const items = sections.map(s => {
    const val = getVal(s);
    const filled = val && val.trim().length > 0;
    const idx = STEPS.indexOf(s);
    return `
      <button class="review-item ${filled ? '' : 'pending'}" onclick="goTo(${idx})">
        <span class="review-item-icon">${s.icon}</span>
        <div class="review-item-body">
          <div class="review-item-label ${filled ? 'filled' : 'empty'}">${esc(s.label)} ${filled ? '' : 'âš ï¸ Pendente'}</div>
          <div class="review-item-preview">${esc(val || 'Clique para preencher...')}</div>
        </div>
        <span class="review-edit">âœï¸</span>
      </button>
    `;
  }).join('');

  return `
    <div class="review-header">
      <div class="icon">ğŸ‰</div>
      <h2>Canvas completo!</h2>
      <p>Revise as informaÃ§Ãµes abaixo. Clique em qualquer seÃ§Ã£o para editar.</p>
      ${data.ra ? `<div class="review-ra">ğŸ“ ${esc(data.ra)}</div>` : ''}
    </div>
    ${items}
    <div class="review-actions">
      <button class="btn-nav btn-nav-next" onclick="exportJSON()">ğŸ’¾ Salvar arquivo</button>
      <button class="btn-nav btn-nav-print" onclick="window.print()">ğŸ–¨ï¸ Imprimir / PDF para o SEI</button>
    </div>
  `;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN RENDER
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function render() {
  const step = STEPS[currentStep];
  const pct = getProgress();
  const isFirst = currentStep === 0;
  const isLast = currentStep === STEPS.length - 1;

  let contentHTML = '';
  if (step.type === 'welcome') contentHTML = renderWelcome();
  else if (step.type === 'review') contentHTML = renderReview();
  else if (step.type === 'partes') contentHTML = renderPartes(step);
  else if (step.type === 'entregas') contentHTML = renderEntregas(step);
  else if (step.field) contentHTML = renderField(step);

  const dots = STEPS.map((s, i) => {
    let cls = 'progress-dot ';
    if (i === currentStep) cls += 'progress-dot-active';
    else if (i < currentStep) cls += 'progress-dot-done';
    else cls += 'progress-dot-todo';
    return `<button class="${cls}" onclick="goTo(${i})" title="${s.label || (s.type === 'welcome' ? 'InÃ­cio' : 'RevisÃ£o')}"></button>`;
  }).join('');

  let navHTML = '';
  if (!isFirst || !step.type) {
    navHTML = `<div class="nav-row no-print">`;
    navHTML += isFirst ? '<div></div>' : `<button class="btn-nav btn-nav-prev" onclick="prev()">â† Anterior</button>`;
    if (isLast) {
      navHTML += `<button class="btn-nav btn-nav-print" onclick="window.print()">ğŸ–¨ï¸ Imprimir / Gerar PDF</button>`;
    } else {
      navHTML += `<button class="btn-nav btn-nav-next" onclick="next()">PrÃ³ximo â†’</button>`;
    }
    navHTML += '</div>';
  }

  document.getElementById('app').innerHTML = `
    <div class="header no-print">
      <div class="header-brand">
        <span>SEGOV/SEGEST â€¢ GovernanÃ§a nas AdministraÃ§Ãµes Regionais</span>
        <h1>Canvas de Projeto</h1>
      </div>
      <div class="header-actions">
        <button class="btn-small" onclick="importJSON()">ğŸ“‚ Importar</button>
        <button class="btn-small" onclick="exportJSON()">ğŸ’¾ Salvar</button>
      </div>
    </div>
    <div class="progress-bar no-print">
      <div class="progress-info">
        <span style="color:var(--text-secondary)">Passo ${Math.min(currentStep + 1, STEPS.length)} de ${STEPS.length}</span>
        <span style="font-weight:700;color:${pct === 100 ? 'var(--accent-green)' : 'var(--accent-blue)'}">${pct}% preenchido</span>
      </div>
      <div class="progress-track"><div class="progress-fill" style="width:${(currentStep / (STEPS.length - 1)) * 100}%"></div></div>
      <div class="progress-dots">${dots}</div>
    </div>
    <div class="step-content">${contentHTML}</div>
    ${navHTML}
    <div class="footer">
      Canvas de Projeto â€¢ SEGOV/SEGEST â€” Assessoria de Planejamento EstratÃ©gico<br>
      Adaptado da Rede ConexÃ£o InovaÃ§Ã£o PÃºblica (CC BY-NC-SA 4.0)
    </div>
  `;
}

// Init
render();
</script>
</body>
</html>
